{"ast":null,"code":"/**\r\n * DevExtreme (data/data_source/data_source.js)\r\n * Version: 18.2.13\r\n * Build date: Wed May 27 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar Class = require(\"../../core/class\"),\n    extend = require(\"../../core/utils/extend\").extend,\n    commonUtils = require(\"../../core/utils/common\"),\n    iteratorUtils = require(\"../../core/utils/iterator\"),\n    ajax = require(\"../../core/utils/ajax\"),\n    typeUtils = require(\"../../core/utils/type\"),\n    dataUtils = require(\"../utils\"),\n    arrayUtils = require(\"../array_utils\"),\n    Store = require(\"../abstract_store\"),\n    ArrayStore = require(\"../array_store\"),\n    CustomStore = require(\"../custom_store\"),\n    EventsMixin = require(\"../../core/events_mixin\"),\n    errors = require(\"../errors\").errors,\n    array = require(\"../../core/utils/array\"),\n    queue = require(\"../../core/utils/queue\"),\n    deferredUtils = require(\"../../core/utils/deferred\"),\n    when = deferredUtils.when,\n    Deferred = deferredUtils.Deferred,\n    __isString = typeUtils.isString,\n    __isNumber = typeUtils.isNumeric,\n    __isBoolean = typeUtils.isBoolean,\n    __isDefined = typeUtils.isDefined;\n\nvar CANCELED_TOKEN = \"canceled\";\n\nfunction OperationManager() {\n  this._counter = -1;\n  this._deferreds = {};\n}\n\nOperationManager.prototype.constructor = OperationManager;\n\nOperationManager.prototype.add = function (deferred) {\n  this._counter += 1;\n  this._deferreds[this._counter] = deferred;\n  return this._counter;\n};\n\nOperationManager.prototype.remove = function (operationId) {\n  return delete this._deferreds[operationId];\n};\n\nOperationManager.prototype.cancel = function (operationId) {\n  if (operationId in this._deferreds) {\n    this._deferreds[operationId].reject(CANCELED_TOKEN);\n\n    return true;\n  }\n\n  return false;\n};\n\nOperationManager.prototype.cancelAll = function () {\n  while (this._counter > -1) {\n    this.cancel(this._counter);\n    this._counter--;\n  }\n};\n\nfunction isPending(deferred) {\n  return \"pending\" === deferred.state();\n}\n\nfunction normalizeDataSourceOptions(options, normalizationOptions) {\n  var store;\n\n  function createCustomStoreFromLoadFunc() {\n    var storeConfig = {};\n    iteratorUtils.each([\"useDefaultSearch\", \"key\", \"load\", \"loadMode\", \"cacheRawData\", \"byKey\", \"lookup\", \"totalCount\", \"insert\", \"update\", \"remove\"], function () {\n      storeConfig[this] = options[this];\n      delete options[this];\n    });\n    return new CustomStore(storeConfig);\n  }\n\n  function createStoreFromConfig(storeConfig) {\n    var alias = storeConfig.type;\n    delete storeConfig.type;\n    return Store.create(alias, storeConfig);\n  }\n\n  function createCustomStoreFromUrl(url) {\n    return new CustomStore({\n      load: function () {\n        return ajax.sendRequest({\n          url: url,\n          dataType: \"json\"\n        });\n      },\n      loadMode: normalizationOptions && normalizationOptions.fromUrlLoadMode\n    });\n  }\n\n  if (\"string\" === typeof options) {\n    options = {\n      paginate: false,\n      store: createCustomStoreFromUrl(options)\n    };\n  }\n\n  if (void 0 === options) {\n    options = [];\n  }\n\n  if (Array.isArray(options) || options instanceof Store) {\n    options = {\n      store: options\n    };\n  } else {\n    options = extend({}, options);\n  }\n\n  if (void 0 === options.store) {\n    options.store = [];\n  }\n\n  store = options.store;\n\n  if (\"load\" in options) {\n    store = createCustomStoreFromLoadFunc();\n  } else {\n    if (Array.isArray(store)) {\n      store = new ArrayStore(store);\n    } else {\n      if (typeUtils.isPlainObject(store)) {\n        store = createStoreFromConfig(extend({}, store));\n      }\n    }\n  }\n\n  options.store = store;\n  return options;\n}\n\nfunction normalizeStoreLoadOptionAccessorArguments(originalArguments) {\n  switch (originalArguments.length) {\n    case 0:\n      return;\n\n    case 1:\n      return originalArguments[0];\n  }\n\n  return [].slice.call(originalArguments);\n}\n\nfunction generateStoreLoadOptionAccessor(optionName) {\n  return function () {\n    var args = normalizeStoreLoadOptionAccessorArguments(arguments);\n\n    if (void 0 === args) {\n      return this._storeLoadOptions[optionName];\n    }\n\n    this._storeLoadOptions[optionName] = args;\n  };\n}\n\nfunction mapDataRespectingGrouping(items, mapper, groupInfo) {\n  function mapRecursive(items, level) {\n    if (!Array.isArray(items)) {\n      return items;\n    }\n\n    return level ? mapGroup(items, level) : iteratorUtils.map(items, mapper);\n  }\n\n  function mapGroup(group, level) {\n    return iteratorUtils.map(group, function (item) {\n      var result = {\n        key: item.key,\n        items: mapRecursive(item.items, level - 1)\n      };\n\n      if (\"aggregates\" in item) {\n        result.aggregates = item.aggregates;\n      }\n\n      return result;\n    });\n  }\n\n  return mapRecursive(items, groupInfo ? dataUtils.normalizeSortingInfo(groupInfo).length : 0);\n}\n\nfunction normalizeLoadResult(data, extra) {\n  if (data && !Array.isArray(data) && data.data) {\n    extra = data;\n    data = data.data;\n  }\n\n  if (!Array.isArray(data)) {\n    data = [data];\n  }\n\n  return {\n    data: data,\n    extra: extra\n  };\n}\n\nvar DataSource = Class.inherit({\n  ctor: function (options) {\n    var _this = this;\n\n    var that = this;\n    options = normalizeDataSourceOptions(options);\n    var onPushHandler = 0 !== options.pushAggregationTimeout ? dataUtils.throttleChanges(this._onPush, function () {\n      if (void 0 === options.pushAggregationTimeout) {\n        return 5 * that._changedTime;\n      }\n\n      return options.pushAggregationTimeout;\n    }) : this._onPush;\n    this._changedTime = 0;\n\n    this._onPushHandler = function (changes) {\n      _this._aggregationTimeoutId = onPushHandler.call(_this, changes);\n    };\n\n    this._store = options.store;\n\n    this._store.on(\"push\", this._onPushHandler);\n\n    this._storeLoadOptions = this._extractLoadOptions(options);\n    this._mapFunc = options.map;\n    this._postProcessFunc = options.postProcess;\n    this._pageIndex = void 0 !== options.pageIndex ? options.pageIndex : 0;\n    this._pageSize = void 0 !== options.pageSize ? options.pageSize : 20;\n    this._loadingCount = 0;\n    this._loadQueue = this._createLoadQueue();\n    this._searchValue = \"searchValue\" in options ? options.searchValue : null;\n    this._searchOperation = options.searchOperation || \"contains\";\n    this._searchExpr = options.searchExpr;\n    this._paginate = options.paginate;\n    this._reshapeOnPush = __isDefined(options.reshapeOnPush) ? options.reshapeOnPush : false;\n    iteratorUtils.each([\"onChanged\", \"onLoadError\", \"onLoadingChanged\", \"onCustomizeLoadResult\", \"onCustomizeStoreLoadOptions\"], function (_, optionName) {\n      if (optionName in options) {\n        that.on(optionName.substr(2, 1).toLowerCase() + optionName.substr(3), options[optionName]);\n      }\n    });\n    this._operationManager = new OperationManager();\n\n    this._init();\n  },\n  _init: function () {\n    this._items = [];\n    this._userData = {};\n    this._totalCount = -1;\n    this._isLoaded = false;\n\n    if (!__isDefined(this._paginate)) {\n      this._paginate = !this.group();\n    }\n\n    this._isLastPage = !this._paginate;\n  },\n  dispose: function () {\n    this._store.off(\"push\", this._onPushHandler);\n\n    this._disposeEvents();\n\n    clearTimeout(this._aggregationTimeoutId);\n    delete this._store;\n\n    if (this._delayedLoadTask) {\n      this._delayedLoadTask.abort();\n    }\n\n    this._operationManager.cancelAll();\n\n    this._disposed = true;\n  },\n  _extractLoadOptions: function (options) {\n    var result = {},\n        names = [\"sort\", \"filter\", \"select\", \"group\", \"requireTotalCount\"],\n        customNames = this._store._customLoadOptions();\n\n    if (customNames) {\n      names = names.concat(customNames);\n    }\n\n    iteratorUtils.each(names, function () {\n      result[this] = options[this];\n    });\n    return result;\n  },\n  loadOptions: function () {\n    return this._storeLoadOptions;\n  },\n  items: function () {\n    return this._items;\n  },\n  pageIndex: function (newIndex) {\n    if (!__isNumber(newIndex)) {\n      return this._pageIndex;\n    }\n\n    this._pageIndex = newIndex;\n    this._isLastPage = !this._paginate;\n  },\n  paginate: function (value) {\n    if (!__isBoolean(value)) {\n      return this._paginate;\n    }\n\n    if (this._paginate !== value) {\n      this._paginate = value;\n      this.pageIndex(0);\n    }\n  },\n  pageSize: function (value) {\n    if (!__isNumber(value)) {\n      return this._pageSize;\n    }\n\n    this._pageSize = value;\n  },\n  isLastPage: function () {\n    return this._isLastPage;\n  },\n  sort: generateStoreLoadOptionAccessor(\"sort\"),\n  filter: function () {\n    var newFilter = normalizeStoreLoadOptionAccessorArguments(arguments);\n\n    if (void 0 === newFilter) {\n      return this._storeLoadOptions.filter;\n    }\n\n    this._storeLoadOptions.filter = newFilter;\n    this.pageIndex(0);\n  },\n  group: generateStoreLoadOptionAccessor(\"group\"),\n  select: generateStoreLoadOptionAccessor(\"select\"),\n  requireTotalCount: function (value) {\n    if (!__isBoolean(value)) {\n      return this._storeLoadOptions.requireTotalCount;\n    }\n\n    this._storeLoadOptions.requireTotalCount = value;\n  },\n  searchValue: function (value) {\n    if (arguments.length < 1) {\n      return this._searchValue;\n    }\n\n    this._searchValue = value;\n    this.pageIndex(0);\n  },\n  searchOperation: function (op) {\n    if (!__isString(op)) {\n      return this._searchOperation;\n    }\n\n    this._searchOperation = op;\n    this.pageIndex(0);\n  },\n  searchExpr: function (expr) {\n    var argc = arguments.length;\n\n    if (0 === argc) {\n      return this._searchExpr;\n    }\n\n    if (argc > 1) {\n      expr = [].slice.call(arguments);\n    }\n\n    this._searchExpr = expr;\n    this.pageIndex(0);\n  },\n  store: function () {\n    return this._store;\n  },\n  key: function () {\n    return this._store && this._store.key();\n  },\n  totalCount: function () {\n    return this._totalCount;\n  },\n  isLoaded: function () {\n    return this._isLoaded;\n  },\n  isLoading: function () {\n    return this._loadingCount > 0;\n  },\n  beginLoading: function () {\n    this._changeLoadingCount(1);\n  },\n  endLoading: function () {\n    this._changeLoadingCount(-1);\n  },\n  _createLoadQueue: function () {\n    return queue.create();\n  },\n  _changeLoadingCount: function (increment) {\n    var newLoading,\n        oldLoading = this.isLoading();\n    this._loadingCount += increment;\n    newLoading = this.isLoading();\n\n    if (oldLoading ^ newLoading) {\n      this.fireEvent(\"loadingChanged\", [newLoading]);\n    }\n  },\n  _scheduleLoadCallbacks: function (deferred) {\n    var that = this;\n    that.beginLoading();\n    deferred.always(function () {\n      that.endLoading();\n    });\n  },\n  _scheduleFailCallbacks: function (deferred) {\n    var that = this;\n    deferred.fail(function () {\n      if (arguments[0] === CANCELED_TOKEN) {\n        return;\n      }\n\n      that.fireEvent(\"loadError\", arguments);\n    });\n  },\n  _fireChanged: function (args) {\n    var date = new Date();\n    this.fireEvent(\"changed\", args);\n    this._changedTime = new Date() - date;\n  },\n  _scheduleChangedCallbacks: function (deferred) {\n    var _this2 = this;\n\n    deferred.done(function () {\n      _this2._fireChanged();\n    });\n  },\n  loadSingle: function (propName, propValue) {\n    var that = this;\n\n    var d = new Deferred(),\n        key = this.key(),\n        store = this._store,\n        options = this._createStoreLoadOptions(),\n        handleDone = function (data) {\n      if (!__isDefined(data) || array.isEmpty(data)) {\n        d.reject(new errors.Error(\"E4009\"));\n      } else {\n        if (!Array.isArray(data)) {\n          data = [data];\n        }\n\n        d.resolve(that._applyMapFunction(data)[0]);\n      }\n    };\n\n    this._scheduleFailCallbacks(d);\n\n    if (arguments.length < 2) {\n      propValue = propName;\n      propName = key;\n    }\n\n    delete options.skip;\n    delete options.group;\n    delete options.refresh;\n    delete options.pageIndex;\n    delete options.searchString;\n\n    function shouldForceByKey() {\n      return store instanceof CustomStore && !store._byKeyViaLoad();\n    }\n\n    (function () {\n      if (propName === key || shouldForceByKey()) {\n        return store.byKey(propValue, options);\n      }\n\n      options.take = 1;\n      options.filter = options.filter ? [options.filter, [propName, propValue]] : [propName, propValue];\n      return store.load(options);\n    })().fail(d.reject).done(handleDone);\n    return d.promise();\n  },\n  load: function () {\n    var loadOperation,\n        that = this,\n        d = new Deferred();\n\n    function loadTask() {\n      if (that._disposed) {\n        return;\n      }\n\n      if (!isPending(d)) {\n        return;\n      }\n\n      return that._loadFromStore(loadOperation, d);\n    }\n\n    this._scheduleLoadCallbacks(d);\n\n    this._scheduleFailCallbacks(d);\n\n    this._scheduleChangedCallbacks(d);\n\n    loadOperation = this._createLoadOperation(d);\n    this.fireEvent(\"customizeStoreLoadOptions\", [loadOperation]);\n\n    this._loadQueue.add(function () {\n      if (\"number\" === typeof loadOperation.delay) {\n        that._delayedLoadTask = commonUtils.executeAsync(loadTask, loadOperation.delay);\n      } else {\n        loadTask();\n      }\n\n      return d.promise();\n    });\n\n    return d.promise({\n      operationId: loadOperation.operationId\n    });\n  },\n  _onPush: function (changes) {\n    if (this._reshapeOnPush) {\n      this.load();\n    } else {\n      this.fireEvent(\"changing\", [{\n        changes: changes\n      }]);\n      var group = this.group(),\n          items = this.items(),\n          groupLevel = 0,\n          dataSourceChanges = this.paginate() || group ? changes.filter(function (item) {\n        return \"update\" === item.type;\n      }) : changes;\n\n      if (group) {\n        groupLevel = Array.isArray(group) ? group.length : 1;\n      }\n\n      arrayUtils.applyBatch(this.store(), items, dataSourceChanges, groupLevel, true);\n\n      this._fireChanged([{\n        changes: changes\n      }]);\n    }\n  },\n  _createLoadOperation: function (deferred) {\n    var id = this._operationManager.add(deferred),\n        options = this._createStoreLoadOptions();\n\n    deferred.always(function () {\n      this._operationManager.remove(id);\n    }.bind(this));\n    return {\n      operationId: id,\n      storeLoadOptions: options\n    };\n  },\n  reload: function () {\n    var store = this.store();\n\n    if (store instanceof CustomStore) {\n      store.clearRawDataCache();\n    }\n\n    this._init();\n\n    return this.load();\n  },\n  cancel: function (operationId) {\n    return this._operationManager.cancel(operationId);\n  },\n  cancelAll: function () {\n    return this._operationManager.cancelAll();\n  },\n  _addSearchOptions: function (storeLoadOptions) {\n    if (this._disposed) {\n      return;\n    }\n\n    if (this.store()._useDefaultSearch) {\n      this._addSearchFilter(storeLoadOptions);\n    } else {\n      storeLoadOptions.searchOperation = this._searchOperation;\n      storeLoadOptions.searchValue = this._searchValue;\n      storeLoadOptions.searchExpr = this._searchExpr;\n    }\n  },\n  _createStoreLoadOptions: function () {\n    var result = extend({}, this._storeLoadOptions);\n\n    this._addSearchOptions(result);\n\n    if (this._paginate) {\n      if (this._pageSize) {\n        result.skip = this._pageIndex * this._pageSize;\n        result.take = this._pageSize;\n      }\n    }\n\n    result.userData = this._userData;\n    return result;\n  },\n  _addSearchFilter: function (storeLoadOptions) {\n    var value = this._searchValue,\n        op = this._searchOperation,\n        selector = this._searchExpr,\n        searchFilter = [];\n\n    if (!value) {\n      return;\n    }\n\n    if (!selector) {\n      selector = \"this\";\n    }\n\n    if (!Array.isArray(selector)) {\n      selector = [selector];\n    }\n\n    iteratorUtils.each(selector, function (i, item) {\n      if (searchFilter.length) {\n        searchFilter.push(\"or\");\n      }\n\n      searchFilter.push([item, op, value]);\n    });\n\n    if (storeLoadOptions.filter) {\n      storeLoadOptions.filter = [searchFilter, storeLoadOptions.filter];\n    } else {\n      storeLoadOptions.filter = searchFilter;\n    }\n  },\n  _loadFromStore: function (loadOptions, pendingDeferred) {\n    var that = this;\n\n    function handleSuccess(data, extra) {\n      function processResult() {\n        var loadResult = extend(normalizeLoadResult(data, extra), loadOptions);\n        that.fireEvent(\"customizeLoadResult\", [loadResult]);\n        when(loadResult.data).done(function (data) {\n          loadResult.data = data;\n\n          that._processStoreLoadResult(loadResult, pendingDeferred);\n        }).fail(pendingDeferred.reject);\n      }\n\n      if (that._disposed) {\n        return;\n      }\n\n      if (!isPending(pendingDeferred)) {\n        return;\n      }\n\n      processResult();\n    }\n\n    if (loadOptions.data) {\n      return new Deferred().resolve(loadOptions.data).done(handleSuccess);\n    }\n\n    return this.store().load(loadOptions.storeLoadOptions).done(handleSuccess).fail(pendingDeferred.reject);\n  },\n  _processStoreLoadResult: function (loadResult, pendingDeferred) {\n    var that = this,\n        data = loadResult.data,\n        extra = loadResult.extra,\n        storeLoadOptions = loadResult.storeLoadOptions;\n\n    function resolvePendingDeferred() {\n      that._isLoaded = true;\n      that._totalCount = isFinite(extra.totalCount) ? extra.totalCount : -1;\n      return pendingDeferred.resolve(data, extra);\n    }\n\n    function proceedLoadingTotalCount() {\n      that.store().totalCount(storeLoadOptions).done(function (count) {\n        extra.totalCount = count;\n        resolvePendingDeferred();\n      }).fail(pendingDeferred.reject);\n    }\n\n    if (that._disposed) {\n      return;\n    }\n\n    data = that._applyPostProcessFunction(that._applyMapFunction(data));\n\n    if (!typeUtils.isPlainObject(extra)) {\n      extra = {};\n    }\n\n    that._items = data;\n\n    if (!data.length || !that._paginate || that._pageSize && data.length < that._pageSize) {\n      that._isLastPage = true;\n    }\n\n    if (storeLoadOptions.requireTotalCount && !isFinite(extra.totalCount)) {\n      proceedLoadingTotalCount();\n    } else {\n      resolvePendingDeferred();\n    }\n  },\n  _applyMapFunction: function (data) {\n    if (this._mapFunc) {\n      return mapDataRespectingGrouping(data, this._mapFunc, this.group());\n    }\n\n    return data;\n  },\n  _applyPostProcessFunction: function (data) {\n    if (this._postProcessFunc) {\n      return this._postProcessFunc(data);\n    }\n\n    return data;\n  }\n}).include(EventsMixin);\nexports.DataSource = DataSource;\nexports.normalizeDataSourceOptions = normalizeDataSourceOptions;\nexports.normalizeLoadResult = normalizeLoadResult;","map":{"version":3,"sources":["C:/Users/abdel/PhpstormProjects/editeur_scenario_jeu/node_modules/devextreme/data/data_source/data_source.js"],"names":["Class","require","extend","commonUtils","iteratorUtils","ajax","typeUtils","dataUtils","arrayUtils","Store","ArrayStore","CustomStore","EventsMixin","errors","array","queue","deferredUtils","when","Deferred","__isString","isString","__isNumber","isNumeric","__isBoolean","isBoolean","__isDefined","isDefined","CANCELED_TOKEN","OperationManager","_counter","_deferreds","prototype","constructor","add","deferred","remove","operationId","cancel","reject","cancelAll","isPending","state","normalizeDataSourceOptions","options","normalizationOptions","store","createCustomStoreFromLoadFunc","storeConfig","each","createStoreFromConfig","alias","type","create","createCustomStoreFromUrl","url","load","sendRequest","dataType","loadMode","fromUrlLoadMode","paginate","Array","isArray","isPlainObject","normalizeStoreLoadOptionAccessorArguments","originalArguments","length","slice","call","generateStoreLoadOptionAccessor","optionName","args","arguments","_storeLoadOptions","mapDataRespectingGrouping","items","mapper","groupInfo","mapRecursive","level","mapGroup","map","group","item","result","key","aggregates","normalizeSortingInfo","normalizeLoadResult","data","extra","DataSource","inherit","ctor","_this","that","onPushHandler","pushAggregationTimeout","throttleChanges","_onPush","_changedTime","_onPushHandler","changes","_aggregationTimeoutId","_store","on","_extractLoadOptions","_mapFunc","_postProcessFunc","postProcess","_pageIndex","pageIndex","_pageSize","pageSize","_loadingCount","_loadQueue","_createLoadQueue","_searchValue","searchValue","_searchOperation","searchOperation","_searchExpr","searchExpr","_paginate","_reshapeOnPush","reshapeOnPush","_","substr","toLowerCase","_operationManager","_init","_items","_userData","_totalCount","_isLoaded","_isLastPage","dispose","off","_disposeEvents","clearTimeout","_delayedLoadTask","abort","_disposed","names","customNames","_customLoadOptions","concat","loadOptions","newIndex","value","isLastPage","sort","filter","newFilter","select","requireTotalCount","op","expr","argc","totalCount","isLoaded","isLoading","beginLoading","_changeLoadingCount","endLoading","increment","newLoading","oldLoading","fireEvent","_scheduleLoadCallbacks","always","_scheduleFailCallbacks","fail","_fireChanged","date","Date","_scheduleChangedCallbacks","_this2","done","loadSingle","propName","propValue","d","_createStoreLoadOptions","handleDone","isEmpty","Error","resolve","_applyMapFunction","skip","refresh","searchString","shouldForceByKey","_byKeyViaLoad","byKey","take","promise","loadOperation","loadTask","_loadFromStore","_createLoadOperation","delay","executeAsync","groupLevel","dataSourceChanges","applyBatch","id","bind","storeLoadOptions","reload","clearRawDataCache","_addSearchOptions","_useDefaultSearch","_addSearchFilter","userData","selector","searchFilter","i","push","pendingDeferred","handleSuccess","processResult","loadResult","_processStoreLoadResult","resolvePendingDeferred","isFinite","proceedLoadingTotalCount","count","_applyPostProcessFunction","include","exports"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (data/data_source/data_source.js)\r\n * Version: 18.2.13\r\n * Build date: Wed May 27 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar Class = require(\"../../core/class\"),\r\n    extend = require(\"../../core/utils/extend\").extend,\r\n    commonUtils = require(\"../../core/utils/common\"),\r\n    iteratorUtils = require(\"../../core/utils/iterator\"),\r\n    ajax = require(\"../../core/utils/ajax\"),\r\n    typeUtils = require(\"../../core/utils/type\"),\r\n    dataUtils = require(\"../utils\"),\r\n    arrayUtils = require(\"../array_utils\"),\r\n    Store = require(\"../abstract_store\"),\r\n    ArrayStore = require(\"../array_store\"),\r\n    CustomStore = require(\"../custom_store\"),\r\n    EventsMixin = require(\"../../core/events_mixin\"),\r\n    errors = require(\"../errors\").errors,\r\n    array = require(\"../../core/utils/array\"),\r\n    queue = require(\"../../core/utils/queue\"),\r\n    deferredUtils = require(\"../../core/utils/deferred\"),\r\n    when = deferredUtils.when,\r\n    Deferred = deferredUtils.Deferred,\r\n    __isString = typeUtils.isString,\r\n    __isNumber = typeUtils.isNumeric,\r\n    __isBoolean = typeUtils.isBoolean,\r\n    __isDefined = typeUtils.isDefined;\r\nvar CANCELED_TOKEN = \"canceled\";\r\n\r\nfunction OperationManager() {\r\n    this._counter = -1;\r\n    this._deferreds = {}\r\n}\r\nOperationManager.prototype.constructor = OperationManager;\r\nOperationManager.prototype.add = function(deferred) {\r\n    this._counter += 1;\r\n    this._deferreds[this._counter] = deferred;\r\n    return this._counter\r\n};\r\nOperationManager.prototype.remove = function(operationId) {\r\n    return delete this._deferreds[operationId]\r\n};\r\nOperationManager.prototype.cancel = function(operationId) {\r\n    if (operationId in this._deferreds) {\r\n        this._deferreds[operationId].reject(CANCELED_TOKEN);\r\n        return true\r\n    }\r\n    return false\r\n};\r\nOperationManager.prototype.cancelAll = function() {\r\n    while (this._counter > -1) {\r\n        this.cancel(this._counter);\r\n        this._counter--\r\n    }\r\n};\r\n\r\nfunction isPending(deferred) {\r\n    return \"pending\" === deferred.state()\r\n}\r\n\r\nfunction normalizeDataSourceOptions(options, normalizationOptions) {\r\n    var store;\r\n\r\n    function createCustomStoreFromLoadFunc() {\r\n        var storeConfig = {};\r\n        iteratorUtils.each([\"useDefaultSearch\", \"key\", \"load\", \"loadMode\", \"cacheRawData\", \"byKey\", \"lookup\", \"totalCount\", \"insert\", \"update\", \"remove\"], function() {\r\n            storeConfig[this] = options[this];\r\n            delete options[this]\r\n        });\r\n        return new CustomStore(storeConfig)\r\n    }\r\n\r\n    function createStoreFromConfig(storeConfig) {\r\n        var alias = storeConfig.type;\r\n        delete storeConfig.type;\r\n        return Store.create(alias, storeConfig)\r\n    }\r\n\r\n    function createCustomStoreFromUrl(url) {\r\n        return new CustomStore({\r\n            load: function() {\r\n                return ajax.sendRequest({\r\n                    url: url,\r\n                    dataType: \"json\"\r\n                })\r\n            },\r\n            loadMode: normalizationOptions && normalizationOptions.fromUrlLoadMode\r\n        })\r\n    }\r\n    if (\"string\" === typeof options) {\r\n        options = {\r\n            paginate: false,\r\n            store: createCustomStoreFromUrl(options)\r\n        }\r\n    }\r\n    if (void 0 === options) {\r\n        options = []\r\n    }\r\n    if (Array.isArray(options) || options instanceof Store) {\r\n        options = {\r\n            store: options\r\n        }\r\n    } else {\r\n        options = extend({}, options)\r\n    }\r\n    if (void 0 === options.store) {\r\n        options.store = []\r\n    }\r\n    store = options.store;\r\n    if (\"load\" in options) {\r\n        store = createCustomStoreFromLoadFunc()\r\n    } else {\r\n        if (Array.isArray(store)) {\r\n            store = new ArrayStore(store)\r\n        } else {\r\n            if (typeUtils.isPlainObject(store)) {\r\n                store = createStoreFromConfig(extend({}, store))\r\n            }\r\n        }\r\n    }\r\n    options.store = store;\r\n    return options\r\n}\r\n\r\nfunction normalizeStoreLoadOptionAccessorArguments(originalArguments) {\r\n    switch (originalArguments.length) {\r\n        case 0:\r\n            return;\r\n        case 1:\r\n            return originalArguments[0]\r\n    }\r\n    return [].slice.call(originalArguments)\r\n}\r\n\r\nfunction generateStoreLoadOptionAccessor(optionName) {\r\n    return function() {\r\n        var args = normalizeStoreLoadOptionAccessorArguments(arguments);\r\n        if (void 0 === args) {\r\n            return this._storeLoadOptions[optionName]\r\n        }\r\n        this._storeLoadOptions[optionName] = args\r\n    }\r\n}\r\n\r\nfunction mapDataRespectingGrouping(items, mapper, groupInfo) {\r\n    function mapRecursive(items, level) {\r\n        if (!Array.isArray(items)) {\r\n            return items\r\n        }\r\n        return level ? mapGroup(items, level) : iteratorUtils.map(items, mapper)\r\n    }\r\n\r\n    function mapGroup(group, level) {\r\n        return iteratorUtils.map(group, function(item) {\r\n            var result = {\r\n                key: item.key,\r\n                items: mapRecursive(item.items, level - 1)\r\n            };\r\n            if (\"aggregates\" in item) {\r\n                result.aggregates = item.aggregates\r\n            }\r\n            return result\r\n        })\r\n    }\r\n    return mapRecursive(items, groupInfo ? dataUtils.normalizeSortingInfo(groupInfo).length : 0)\r\n}\r\n\r\nfunction normalizeLoadResult(data, extra) {\r\n    if (data && !Array.isArray(data) && data.data) {\r\n        extra = data;\r\n        data = data.data\r\n    }\r\n    if (!Array.isArray(data)) {\r\n        data = [data]\r\n    }\r\n    return {\r\n        data: data,\r\n        extra: extra\r\n    }\r\n}\r\nvar DataSource = Class.inherit({\r\n    ctor: function(options) {\r\n        var _this = this;\r\n        var that = this;\r\n        options = normalizeDataSourceOptions(options);\r\n        var onPushHandler = 0 !== options.pushAggregationTimeout ? dataUtils.throttleChanges(this._onPush, function() {\r\n            if (void 0 === options.pushAggregationTimeout) {\r\n                return 5 * that._changedTime\r\n            }\r\n            return options.pushAggregationTimeout\r\n        }) : this._onPush;\r\n        this._changedTime = 0;\r\n        this._onPushHandler = function(changes) {\r\n            _this._aggregationTimeoutId = onPushHandler.call(_this, changes)\r\n        };\r\n        this._store = options.store;\r\n        this._store.on(\"push\", this._onPushHandler);\r\n        this._storeLoadOptions = this._extractLoadOptions(options);\r\n        this._mapFunc = options.map;\r\n        this._postProcessFunc = options.postProcess;\r\n        this._pageIndex = void 0 !== options.pageIndex ? options.pageIndex : 0;\r\n        this._pageSize = void 0 !== options.pageSize ? options.pageSize : 20;\r\n        this._loadingCount = 0;\r\n        this._loadQueue = this._createLoadQueue();\r\n        this._searchValue = \"searchValue\" in options ? options.searchValue : null;\r\n        this._searchOperation = options.searchOperation || \"contains\";\r\n        this._searchExpr = options.searchExpr;\r\n        this._paginate = options.paginate;\r\n        this._reshapeOnPush = __isDefined(options.reshapeOnPush) ? options.reshapeOnPush : false;\r\n        iteratorUtils.each([\"onChanged\", \"onLoadError\", \"onLoadingChanged\", \"onCustomizeLoadResult\", \"onCustomizeStoreLoadOptions\"], function(_, optionName) {\r\n            if (optionName in options) {\r\n                that.on(optionName.substr(2, 1).toLowerCase() + optionName.substr(3), options[optionName])\r\n            }\r\n        });\r\n        this._operationManager = new OperationManager;\r\n        this._init()\r\n    },\r\n    _init: function() {\r\n        this._items = [];\r\n        this._userData = {};\r\n        this._totalCount = -1;\r\n        this._isLoaded = false;\r\n        if (!__isDefined(this._paginate)) {\r\n            this._paginate = !this.group()\r\n        }\r\n        this._isLastPage = !this._paginate\r\n    },\r\n    dispose: function() {\r\n        this._store.off(\"push\", this._onPushHandler);\r\n        this._disposeEvents();\r\n        clearTimeout(this._aggregationTimeoutId);\r\n        delete this._store;\r\n        if (this._delayedLoadTask) {\r\n            this._delayedLoadTask.abort()\r\n        }\r\n        this._operationManager.cancelAll();\r\n        this._disposed = true\r\n    },\r\n    _extractLoadOptions: function(options) {\r\n        var result = {},\r\n            names = [\"sort\", \"filter\", \"select\", \"group\", \"requireTotalCount\"],\r\n            customNames = this._store._customLoadOptions();\r\n        if (customNames) {\r\n            names = names.concat(customNames)\r\n        }\r\n        iteratorUtils.each(names, function() {\r\n            result[this] = options[this]\r\n        });\r\n        return result\r\n    },\r\n    loadOptions: function() {\r\n        return this._storeLoadOptions\r\n    },\r\n    items: function() {\r\n        return this._items\r\n    },\r\n    pageIndex: function(newIndex) {\r\n        if (!__isNumber(newIndex)) {\r\n            return this._pageIndex\r\n        }\r\n        this._pageIndex = newIndex;\r\n        this._isLastPage = !this._paginate\r\n    },\r\n    paginate: function(value) {\r\n        if (!__isBoolean(value)) {\r\n            return this._paginate\r\n        }\r\n        if (this._paginate !== value) {\r\n            this._paginate = value;\r\n            this.pageIndex(0)\r\n        }\r\n    },\r\n    pageSize: function(value) {\r\n        if (!__isNumber(value)) {\r\n            return this._pageSize\r\n        }\r\n        this._pageSize = value\r\n    },\r\n    isLastPage: function() {\r\n        return this._isLastPage\r\n    },\r\n    sort: generateStoreLoadOptionAccessor(\"sort\"),\r\n    filter: function() {\r\n        var newFilter = normalizeStoreLoadOptionAccessorArguments(arguments);\r\n        if (void 0 === newFilter) {\r\n            return this._storeLoadOptions.filter\r\n        }\r\n        this._storeLoadOptions.filter = newFilter;\r\n        this.pageIndex(0)\r\n    },\r\n    group: generateStoreLoadOptionAccessor(\"group\"),\r\n    select: generateStoreLoadOptionAccessor(\"select\"),\r\n    requireTotalCount: function(value) {\r\n        if (!__isBoolean(value)) {\r\n            return this._storeLoadOptions.requireTotalCount\r\n        }\r\n        this._storeLoadOptions.requireTotalCount = value\r\n    },\r\n    searchValue: function(value) {\r\n        if (arguments.length < 1) {\r\n            return this._searchValue\r\n        }\r\n        this._searchValue = value;\r\n        this.pageIndex(0)\r\n    },\r\n    searchOperation: function(op) {\r\n        if (!__isString(op)) {\r\n            return this._searchOperation\r\n        }\r\n        this._searchOperation = op;\r\n        this.pageIndex(0)\r\n    },\r\n    searchExpr: function(expr) {\r\n        var argc = arguments.length;\r\n        if (0 === argc) {\r\n            return this._searchExpr\r\n        }\r\n        if (argc > 1) {\r\n            expr = [].slice.call(arguments)\r\n        }\r\n        this._searchExpr = expr;\r\n        this.pageIndex(0)\r\n    },\r\n    store: function() {\r\n        return this._store\r\n    },\r\n    key: function() {\r\n        return this._store && this._store.key()\r\n    },\r\n    totalCount: function() {\r\n        return this._totalCount\r\n    },\r\n    isLoaded: function() {\r\n        return this._isLoaded\r\n    },\r\n    isLoading: function() {\r\n        return this._loadingCount > 0\r\n    },\r\n    beginLoading: function() {\r\n        this._changeLoadingCount(1)\r\n    },\r\n    endLoading: function() {\r\n        this._changeLoadingCount(-1)\r\n    },\r\n    _createLoadQueue: function() {\r\n        return queue.create()\r\n    },\r\n    _changeLoadingCount: function(increment) {\r\n        var newLoading, oldLoading = this.isLoading();\r\n        this._loadingCount += increment;\r\n        newLoading = this.isLoading();\r\n        if (oldLoading ^ newLoading) {\r\n            this.fireEvent(\"loadingChanged\", [newLoading])\r\n        }\r\n    },\r\n    _scheduleLoadCallbacks: function(deferred) {\r\n        var that = this;\r\n        that.beginLoading();\r\n        deferred.always(function() {\r\n            that.endLoading()\r\n        })\r\n    },\r\n    _scheduleFailCallbacks: function(deferred) {\r\n        var that = this;\r\n        deferred.fail(function() {\r\n            if (arguments[0] === CANCELED_TOKEN) {\r\n                return\r\n            }\r\n            that.fireEvent(\"loadError\", arguments)\r\n        })\r\n    },\r\n    _fireChanged: function(args) {\r\n        var date = new Date;\r\n        this.fireEvent(\"changed\", args);\r\n        this._changedTime = new Date - date\r\n    },\r\n    _scheduleChangedCallbacks: function(deferred) {\r\n        var _this2 = this;\r\n        deferred.done(function() {\r\n            _this2._fireChanged()\r\n        })\r\n    },\r\n    loadSingle: function(propName, propValue) {\r\n        var that = this;\r\n        var d = new Deferred,\r\n            key = this.key(),\r\n            store = this._store,\r\n            options = this._createStoreLoadOptions(),\r\n            handleDone = function(data) {\r\n                if (!__isDefined(data) || array.isEmpty(data)) {\r\n                    d.reject(new errors.Error(\"E4009\"))\r\n                } else {\r\n                    if (!Array.isArray(data)) {\r\n                        data = [data]\r\n                    }\r\n                    d.resolve(that._applyMapFunction(data)[0])\r\n                }\r\n            };\r\n        this._scheduleFailCallbacks(d);\r\n        if (arguments.length < 2) {\r\n            propValue = propName;\r\n            propName = key\r\n        }\r\n        delete options.skip;\r\n        delete options.group;\r\n        delete options.refresh;\r\n        delete options.pageIndex;\r\n        delete options.searchString;\r\n\r\n        function shouldForceByKey() {\r\n            return store instanceof CustomStore && !store._byKeyViaLoad()\r\n        }(function() {\r\n            if (propName === key || shouldForceByKey()) {\r\n                return store.byKey(propValue, options)\r\n            }\r\n            options.take = 1;\r\n            options.filter = options.filter ? [options.filter, [propName, propValue]] : [propName, propValue];\r\n            return store.load(options)\r\n        })().fail(d.reject).done(handleDone);\r\n        return d.promise()\r\n    },\r\n    load: function() {\r\n        var loadOperation, that = this,\r\n            d = new Deferred;\r\n\r\n        function loadTask() {\r\n            if (that._disposed) {\r\n                return\r\n            }\r\n            if (!isPending(d)) {\r\n                return\r\n            }\r\n            return that._loadFromStore(loadOperation, d)\r\n        }\r\n        this._scheduleLoadCallbacks(d);\r\n        this._scheduleFailCallbacks(d);\r\n        this._scheduleChangedCallbacks(d);\r\n        loadOperation = this._createLoadOperation(d);\r\n        this.fireEvent(\"customizeStoreLoadOptions\", [loadOperation]);\r\n        this._loadQueue.add(function() {\r\n            if (\"number\" === typeof loadOperation.delay) {\r\n                that._delayedLoadTask = commonUtils.executeAsync(loadTask, loadOperation.delay)\r\n            } else {\r\n                loadTask()\r\n            }\r\n            return d.promise()\r\n        });\r\n        return d.promise({\r\n            operationId: loadOperation.operationId\r\n        })\r\n    },\r\n    _onPush: function(changes) {\r\n        if (this._reshapeOnPush) {\r\n            this.load()\r\n        } else {\r\n            this.fireEvent(\"changing\", [{\r\n                changes: changes\r\n            }]);\r\n            var group = this.group(),\r\n                items = this.items(),\r\n                groupLevel = 0,\r\n                dataSourceChanges = this.paginate() || group ? changes.filter(function(item) {\r\n                    return \"update\" === item.type\r\n                }) : changes;\r\n            if (group) {\r\n                groupLevel = Array.isArray(group) ? group.length : 1\r\n            }\r\n            arrayUtils.applyBatch(this.store(), items, dataSourceChanges, groupLevel, true);\r\n            this._fireChanged([{\r\n                changes: changes\r\n            }])\r\n        }\r\n    },\r\n    _createLoadOperation: function(deferred) {\r\n        var id = this._operationManager.add(deferred),\r\n            options = this._createStoreLoadOptions();\r\n        deferred.always(function() {\r\n            this._operationManager.remove(id)\r\n        }.bind(this));\r\n        return {\r\n            operationId: id,\r\n            storeLoadOptions: options\r\n        }\r\n    },\r\n    reload: function() {\r\n        var store = this.store();\r\n        if (store instanceof CustomStore) {\r\n            store.clearRawDataCache()\r\n        }\r\n        this._init();\r\n        return this.load()\r\n    },\r\n    cancel: function(operationId) {\r\n        return this._operationManager.cancel(operationId)\r\n    },\r\n    cancelAll: function() {\r\n        return this._operationManager.cancelAll()\r\n    },\r\n    _addSearchOptions: function(storeLoadOptions) {\r\n        if (this._disposed) {\r\n            return\r\n        }\r\n        if (this.store()._useDefaultSearch) {\r\n            this._addSearchFilter(storeLoadOptions)\r\n        } else {\r\n            storeLoadOptions.searchOperation = this._searchOperation;\r\n            storeLoadOptions.searchValue = this._searchValue;\r\n            storeLoadOptions.searchExpr = this._searchExpr\r\n        }\r\n    },\r\n    _createStoreLoadOptions: function() {\r\n        var result = extend({}, this._storeLoadOptions);\r\n        this._addSearchOptions(result);\r\n        if (this._paginate) {\r\n            if (this._pageSize) {\r\n                result.skip = this._pageIndex * this._pageSize;\r\n                result.take = this._pageSize\r\n            }\r\n        }\r\n        result.userData = this._userData;\r\n        return result\r\n    },\r\n    _addSearchFilter: function(storeLoadOptions) {\r\n        var value = this._searchValue,\r\n            op = this._searchOperation,\r\n            selector = this._searchExpr,\r\n            searchFilter = [];\r\n        if (!value) {\r\n            return\r\n        }\r\n        if (!selector) {\r\n            selector = \"this\"\r\n        }\r\n        if (!Array.isArray(selector)) {\r\n            selector = [selector]\r\n        }\r\n        iteratorUtils.each(selector, function(i, item) {\r\n            if (searchFilter.length) {\r\n                searchFilter.push(\"or\")\r\n            }\r\n            searchFilter.push([item, op, value])\r\n        });\r\n        if (storeLoadOptions.filter) {\r\n            storeLoadOptions.filter = [searchFilter, storeLoadOptions.filter]\r\n        } else {\r\n            storeLoadOptions.filter = searchFilter\r\n        }\r\n    },\r\n    _loadFromStore: function(loadOptions, pendingDeferred) {\r\n        var that = this;\r\n\r\n        function handleSuccess(data, extra) {\r\n            function processResult() {\r\n                var loadResult = extend(normalizeLoadResult(data, extra), loadOptions);\r\n                that.fireEvent(\"customizeLoadResult\", [loadResult]);\r\n                when(loadResult.data).done(function(data) {\r\n                    loadResult.data = data;\r\n                    that._processStoreLoadResult(loadResult, pendingDeferred)\r\n                }).fail(pendingDeferred.reject)\r\n            }\r\n            if (that._disposed) {\r\n                return\r\n            }\r\n            if (!isPending(pendingDeferred)) {\r\n                return\r\n            }\r\n            processResult()\r\n        }\r\n        if (loadOptions.data) {\r\n            return (new Deferred).resolve(loadOptions.data).done(handleSuccess)\r\n        }\r\n        return this.store().load(loadOptions.storeLoadOptions).done(handleSuccess).fail(pendingDeferred.reject)\r\n    },\r\n    _processStoreLoadResult: function(loadResult, pendingDeferred) {\r\n        var that = this,\r\n            data = loadResult.data,\r\n            extra = loadResult.extra,\r\n            storeLoadOptions = loadResult.storeLoadOptions;\r\n\r\n        function resolvePendingDeferred() {\r\n            that._isLoaded = true;\r\n            that._totalCount = isFinite(extra.totalCount) ? extra.totalCount : -1;\r\n            return pendingDeferred.resolve(data, extra)\r\n        }\r\n\r\n        function proceedLoadingTotalCount() {\r\n            that.store().totalCount(storeLoadOptions).done(function(count) {\r\n                extra.totalCount = count;\r\n                resolvePendingDeferred()\r\n            }).fail(pendingDeferred.reject)\r\n        }\r\n        if (that._disposed) {\r\n            return\r\n        }\r\n        data = that._applyPostProcessFunction(that._applyMapFunction(data));\r\n        if (!typeUtils.isPlainObject(extra)) {\r\n            extra = {}\r\n        }\r\n        that._items = data;\r\n        if (!data.length || !that._paginate || that._pageSize && data.length < that._pageSize) {\r\n            that._isLastPage = true\r\n        }\r\n        if (storeLoadOptions.requireTotalCount && !isFinite(extra.totalCount)) {\r\n            proceedLoadingTotalCount()\r\n        } else {\r\n            resolvePendingDeferred()\r\n        }\r\n    },\r\n    _applyMapFunction: function(data) {\r\n        if (this._mapFunc) {\r\n            return mapDataRespectingGrouping(data, this._mapFunc, this.group())\r\n        }\r\n        return data\r\n    },\r\n    _applyPostProcessFunction: function(data) {\r\n        if (this._postProcessFunc) {\r\n            return this._postProcessFunc(data)\r\n        }\r\n        return data\r\n    }\r\n}).include(EventsMixin);\r\nexports.DataSource = DataSource;\r\nexports.normalizeDataSourceOptions = normalizeDataSourceOptions;\r\nexports.normalizeLoadResult = normalizeLoadResult;\r\n"]},"metadata":{},"sourceType":"script"}