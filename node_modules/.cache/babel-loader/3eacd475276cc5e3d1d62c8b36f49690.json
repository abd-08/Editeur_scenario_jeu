{"ast":null,"code":"/**\r\n * DevExtreme (events/core/emitter_registrator.js)\r\n * Version: 18.2.13\r\n * Build date: Wed May 27 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar $ = require(\"../../core/renderer\"),\n    readyCallbacks = require(\"../../core/utils/ready_callbacks\"),\n    domAdapter = require(\"../../core/dom_adapter\"),\n    eventsEngine = require(\"../../events/core/events_engine\"),\n    dataUtils = require(\"../../core/element_data\"),\n    Class = require(\"../../core/class\"),\n    extend = require(\"../../core/utils/extend\").extend,\n    inArray = require(\"../../core/utils/array\").inArray,\n    each = require(\"../../core/utils/iterator\").each,\n    registerEvent = require(\"./event_registrator\"),\n    eventUtils = require(\"../utils\"),\n    pointerEvents = require(\"../pointer\"),\n    wheelEvent = require(\"./wheel\");\n\nvar MANAGER_EVENT = \"dxEventManager\",\n    EMITTER_DATA = \"dxEmitter\";\nvar EventManager = Class.inherit({\n  ctor: function () {\n    this._attachHandlers();\n\n    this.reset();\n    this._proxiedCancelHandler = this._cancelHandler.bind(this);\n    this._proxiedAcceptHandler = this._acceptHandler.bind(this);\n  },\n  _attachHandlers: function () {\n    readyCallbacks.add(function () {\n      var document = domAdapter.getDocument();\n      eventsEngine.subscribeGlobal(document, eventUtils.addNamespace(pointerEvents.down, MANAGER_EVENT), this._pointerDownHandler.bind(this));\n      eventsEngine.subscribeGlobal(document, eventUtils.addNamespace(pointerEvents.move, MANAGER_EVENT), this._pointerMoveHandler.bind(this));\n      eventsEngine.subscribeGlobal(document, eventUtils.addNamespace([pointerEvents.up, pointerEvents.cancel].join(\" \"), MANAGER_EVENT), this._pointerUpHandler.bind(this));\n      eventsEngine.subscribeGlobal(document, eventUtils.addNamespace(wheelEvent.name, MANAGER_EVENT), this._mouseWheelHandler.bind(this));\n    }.bind(this));\n  },\n  _eachEmitter: function (callback) {\n    var activeEmitters = this._activeEmitters || [];\n    var i = 0;\n\n    while (activeEmitters.length > i) {\n      var emitter = activeEmitters[i];\n\n      if (false === callback(emitter)) {\n        break;\n      }\n\n      if (activeEmitters[i] === emitter) {\n        i++;\n      }\n    }\n  },\n  _applyToEmitters: function (method, arg) {\n    this._eachEmitter(function (emitter) {\n      emitter[method].call(emitter, arg);\n    });\n  },\n  reset: function () {\n    this._eachEmitter(this._proxiedCancelHandler);\n\n    this._activeEmitters = [];\n  },\n  resetEmitter: function (emitter) {\n    this._proxiedCancelHandler(emitter);\n  },\n  _pointerDownHandler: function (e) {\n    if (eventUtils.isMouseEvent(e) && e.which > 1) {\n      return;\n    }\n\n    this._updateEmitters(e);\n  },\n  _updateEmitters: function (e) {\n    if (!this._isSetChanged(e)) {\n      return;\n    }\n\n    this._cleanEmitters(e);\n\n    this._fetchEmitters(e);\n  },\n  _isSetChanged: function (e) {\n    var currentSet = this._closestEmitter(e);\n\n    var previousSet = this._emittersSet || [];\n    var setChanged = currentSet.length !== previousSet.length;\n    each(currentSet, function (index, emitter) {\n      setChanged = setChanged || previousSet[index] !== emitter;\n      return !setChanged;\n    });\n    this._emittersSet = currentSet;\n    return setChanged;\n  },\n  _closestEmitter: function (e) {\n    var that = this,\n        result = [],\n        $element = $(e.target);\n\n    function handleEmitter(_, emitter) {\n      if (!!emitter && emitter.validatePointers(e) && emitter.validate(e)) {\n        emitter.addCancelCallback(that._proxiedCancelHandler);\n        emitter.addAcceptCallback(that._proxiedAcceptHandler);\n        result.push(emitter);\n      }\n    }\n\n    while ($element.length) {\n      var emitters = dataUtils.data($element.get(0), EMITTER_DATA) || [];\n      each(emitters, handleEmitter);\n      $element = $element.parent();\n    }\n\n    return result;\n  },\n  _acceptHandler: function (acceptedEmitter, e) {\n    var that = this;\n\n    this._eachEmitter(function (emitter) {\n      if (emitter !== acceptedEmitter) {\n        that._cancelEmitter(emitter, e);\n      }\n    });\n  },\n  _cancelHandler: function (canceledEmitter, e) {\n    this._cancelEmitter(canceledEmitter, e);\n  },\n  _cancelEmitter: function (emitter, e) {\n    var activeEmitters = this._activeEmitters;\n\n    if (e) {\n      emitter.cancel(e);\n    } else {\n      emitter.reset();\n    }\n\n    emitter.removeCancelCallback();\n    emitter.removeAcceptCallback();\n    var emitterIndex = inArray(emitter, activeEmitters);\n\n    if (emitterIndex > -1) {\n      activeEmitters.splice(emitterIndex, 1);\n    }\n  },\n  _cleanEmitters: function (e) {\n    this._applyToEmitters(\"end\", e);\n\n    this.reset(e);\n  },\n  _fetchEmitters: function (e) {\n    this._activeEmitters = this._emittersSet.slice();\n\n    this._applyToEmitters(\"start\", e);\n  },\n  _pointerMoveHandler: function (e) {\n    this._applyToEmitters(\"move\", e);\n  },\n  _pointerUpHandler: function (e) {\n    this._updateEmitters(e);\n  },\n  _mouseWheelHandler: function (e) {\n    if (!this._allowInterruptionByMouseWheel()) {\n      return;\n    }\n\n    e.pointers = [null];\n\n    this._pointerDownHandler(e);\n\n    this._adjustWheelEvent(e);\n\n    this._pointerMoveHandler(e);\n\n    e.pointers = [];\n\n    this._pointerUpHandler(e);\n  },\n  _allowInterruptionByMouseWheel: function () {\n    var allowInterruption = true;\n\n    this._eachEmitter(function (emitter) {\n      allowInterruption = emitter.allowInterruptionByMouseWheel() && allowInterruption;\n      return allowInterruption;\n    });\n\n    return allowInterruption;\n  },\n  _adjustWheelEvent: function (e) {\n    var closestGestureEmitter = null;\n\n    this._eachEmitter(function (emitter) {\n      if (!emitter.gesture) {\n        return;\n      }\n\n      var direction = emitter.getDirection(e);\n\n      if (\"horizontal\" !== direction && !e.shiftKey || \"vertical\" !== direction && e.shiftKey) {\n        closestGestureEmitter = emitter;\n        return false;\n      }\n    });\n\n    if (!closestGestureEmitter) {\n      return;\n    }\n\n    var direction = closestGestureEmitter.getDirection(e),\n        verticalGestureDirection = \"both\" === direction && !e.shiftKey || \"vertical\" === direction,\n        prop = verticalGestureDirection ? \"pageY\" : \"pageX\";\n    e[prop] += e.delta;\n  },\n  isActive: function (element) {\n    var result = false;\n\n    this._eachEmitter(function (emitter) {\n      result = result || emitter.getElement().is(element);\n    });\n\n    return result;\n  }\n});\nvar eventManager = new EventManager();\nvar EMITTER_SUBSCRIPTION_DATA = \"dxEmitterSubscription\";\n\nvar registerEmitter = function (emitterConfig) {\n  var emitterClass = emitterConfig.emitter,\n      emitterName = emitterConfig.events[0],\n      emitterEvents = emitterConfig.events;\n  each(emitterEvents, function (_, eventName) {\n    registerEvent(eventName, {\n      noBubble: !emitterConfig.bubble,\n      setup: function (element) {\n        var subscriptions = dataUtils.data(element, EMITTER_SUBSCRIPTION_DATA) || {},\n            emitters = dataUtils.data(element, EMITTER_DATA) || {},\n            emitter = emitters[emitterName] || new emitterClass(element);\n        subscriptions[eventName] = true;\n        emitters[emitterName] = emitter;\n        dataUtils.data(element, EMITTER_DATA, emitters);\n        dataUtils.data(element, EMITTER_SUBSCRIPTION_DATA, subscriptions);\n      },\n      add: function (element, handleObj) {\n        var emitters = dataUtils.data(element, EMITTER_DATA),\n            emitter = emitters[emitterName];\n        emitter.configure(extend({\n          delegateSelector: handleObj.selector\n        }, handleObj.data), handleObj.type);\n      },\n      teardown: function (element) {\n        var subscriptions = dataUtils.data(element, EMITTER_SUBSCRIPTION_DATA),\n            emitters = dataUtils.data(element, EMITTER_DATA),\n            emitter = emitters[emitterName];\n        delete subscriptions[eventName];\n        var disposeEmitter = true;\n        each(emitterEvents, function (_, eventName) {\n          disposeEmitter = disposeEmitter && !subscriptions[eventName];\n          return disposeEmitter;\n        });\n\n        if (disposeEmitter) {\n          if (eventManager.isActive(element)) {\n            eventManager.resetEmitter(emitter);\n          }\n\n          emitter && emitter.dispose();\n          delete emitters[emitterName];\n        }\n      }\n    });\n  });\n};\n\nmodule.exports = registerEmitter;","map":{"version":3,"sources":["C:/Users/abdel/PhpstormProjects/editeur_scenario_jeu/node_modules/devextreme/events/core/emitter_registrator.js"],"names":["$","require","readyCallbacks","domAdapter","eventsEngine","dataUtils","Class","extend","inArray","each","registerEvent","eventUtils","pointerEvents","wheelEvent","MANAGER_EVENT","EMITTER_DATA","EventManager","inherit","ctor","_attachHandlers","reset","_proxiedCancelHandler","_cancelHandler","bind","_proxiedAcceptHandler","_acceptHandler","add","document","getDocument","subscribeGlobal","addNamespace","down","_pointerDownHandler","move","_pointerMoveHandler","up","cancel","join","_pointerUpHandler","name","_mouseWheelHandler","_eachEmitter","callback","activeEmitters","_activeEmitters","i","length","emitter","_applyToEmitters","method","arg","call","resetEmitter","e","isMouseEvent","which","_updateEmitters","_isSetChanged","_cleanEmitters","_fetchEmitters","currentSet","_closestEmitter","previousSet","_emittersSet","setChanged","index","that","result","$element","target","handleEmitter","_","validatePointers","validate","addCancelCallback","addAcceptCallback","push","emitters","data","get","parent","acceptedEmitter","_cancelEmitter","canceledEmitter","removeCancelCallback","removeAcceptCallback","emitterIndex","splice","slice","_allowInterruptionByMouseWheel","pointers","_adjustWheelEvent","allowInterruption","allowInterruptionByMouseWheel","closestGestureEmitter","gesture","direction","getDirection","shiftKey","verticalGestureDirection","prop","delta","isActive","element","getElement","is","eventManager","EMITTER_SUBSCRIPTION_DATA","registerEmitter","emitterConfig","emitterClass","emitterName","events","emitterEvents","eventName","noBubble","bubble","setup","subscriptions","handleObj","configure","delegateSelector","selector","type","teardown","disposeEmitter","dispose","module","exports"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (events/core/emitter_registrator.js)\r\n * Version: 18.2.13\r\n * Build date: Wed May 27 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar $ = require(\"../../core/renderer\"),\r\n    readyCallbacks = require(\"../../core/utils/ready_callbacks\"),\r\n    domAdapter = require(\"../../core/dom_adapter\"),\r\n    eventsEngine = require(\"../../events/core/events_engine\"),\r\n    dataUtils = require(\"../../core/element_data\"),\r\n    Class = require(\"../../core/class\"),\r\n    extend = require(\"../../core/utils/extend\").extend,\r\n    inArray = require(\"../../core/utils/array\").inArray,\r\n    each = require(\"../../core/utils/iterator\").each,\r\n    registerEvent = require(\"./event_registrator\"),\r\n    eventUtils = require(\"../utils\"),\r\n    pointerEvents = require(\"../pointer\"),\r\n    wheelEvent = require(\"./wheel\");\r\nvar MANAGER_EVENT = \"dxEventManager\",\r\n    EMITTER_DATA = \"dxEmitter\";\r\nvar EventManager = Class.inherit({\r\n    ctor: function() {\r\n        this._attachHandlers();\r\n        this.reset();\r\n        this._proxiedCancelHandler = this._cancelHandler.bind(this);\r\n        this._proxiedAcceptHandler = this._acceptHandler.bind(this)\r\n    },\r\n    _attachHandlers: function() {\r\n        readyCallbacks.add(function() {\r\n            var document = domAdapter.getDocument();\r\n            eventsEngine.subscribeGlobal(document, eventUtils.addNamespace(pointerEvents.down, MANAGER_EVENT), this._pointerDownHandler.bind(this));\r\n            eventsEngine.subscribeGlobal(document, eventUtils.addNamespace(pointerEvents.move, MANAGER_EVENT), this._pointerMoveHandler.bind(this));\r\n            eventsEngine.subscribeGlobal(document, eventUtils.addNamespace([pointerEvents.up, pointerEvents.cancel].join(\" \"), MANAGER_EVENT), this._pointerUpHandler.bind(this));\r\n            eventsEngine.subscribeGlobal(document, eventUtils.addNamespace(wheelEvent.name, MANAGER_EVENT), this._mouseWheelHandler.bind(this))\r\n        }.bind(this))\r\n    },\r\n    _eachEmitter: function(callback) {\r\n        var activeEmitters = this._activeEmitters || [];\r\n        var i = 0;\r\n        while (activeEmitters.length > i) {\r\n            var emitter = activeEmitters[i];\r\n            if (false === callback(emitter)) {\r\n                break\r\n            }\r\n            if (activeEmitters[i] === emitter) {\r\n                i++\r\n            }\r\n        }\r\n    },\r\n    _applyToEmitters: function(method, arg) {\r\n        this._eachEmitter(function(emitter) {\r\n            emitter[method].call(emitter, arg)\r\n        })\r\n    },\r\n    reset: function() {\r\n        this._eachEmitter(this._proxiedCancelHandler);\r\n        this._activeEmitters = []\r\n    },\r\n    resetEmitter: function(emitter) {\r\n        this._proxiedCancelHandler(emitter)\r\n    },\r\n    _pointerDownHandler: function(e) {\r\n        if (eventUtils.isMouseEvent(e) && e.which > 1) {\r\n            return\r\n        }\r\n        this._updateEmitters(e)\r\n    },\r\n    _updateEmitters: function(e) {\r\n        if (!this._isSetChanged(e)) {\r\n            return\r\n        }\r\n        this._cleanEmitters(e);\r\n        this._fetchEmitters(e)\r\n    },\r\n    _isSetChanged: function(e) {\r\n        var currentSet = this._closestEmitter(e);\r\n        var previousSet = this._emittersSet || [];\r\n        var setChanged = currentSet.length !== previousSet.length;\r\n        each(currentSet, function(index, emitter) {\r\n            setChanged = setChanged || previousSet[index] !== emitter;\r\n            return !setChanged\r\n        });\r\n        this._emittersSet = currentSet;\r\n        return setChanged\r\n    },\r\n    _closestEmitter: function(e) {\r\n        var that = this,\r\n            result = [],\r\n            $element = $(e.target);\r\n\r\n        function handleEmitter(_, emitter) {\r\n            if (!!emitter && emitter.validatePointers(e) && emitter.validate(e)) {\r\n                emitter.addCancelCallback(that._proxiedCancelHandler);\r\n                emitter.addAcceptCallback(that._proxiedAcceptHandler);\r\n                result.push(emitter)\r\n            }\r\n        }\r\n        while ($element.length) {\r\n            var emitters = dataUtils.data($element.get(0), EMITTER_DATA) || [];\r\n            each(emitters, handleEmitter);\r\n            $element = $element.parent()\r\n        }\r\n        return result\r\n    },\r\n    _acceptHandler: function(acceptedEmitter, e) {\r\n        var that = this;\r\n        this._eachEmitter(function(emitter) {\r\n            if (emitter !== acceptedEmitter) {\r\n                that._cancelEmitter(emitter, e)\r\n            }\r\n        })\r\n    },\r\n    _cancelHandler: function(canceledEmitter, e) {\r\n        this._cancelEmitter(canceledEmitter, e)\r\n    },\r\n    _cancelEmitter: function(emitter, e) {\r\n        var activeEmitters = this._activeEmitters;\r\n        if (e) {\r\n            emitter.cancel(e)\r\n        } else {\r\n            emitter.reset()\r\n        }\r\n        emitter.removeCancelCallback();\r\n        emitter.removeAcceptCallback();\r\n        var emitterIndex = inArray(emitter, activeEmitters);\r\n        if (emitterIndex > -1) {\r\n            activeEmitters.splice(emitterIndex, 1)\r\n        }\r\n    },\r\n    _cleanEmitters: function(e) {\r\n        this._applyToEmitters(\"end\", e);\r\n        this.reset(e)\r\n    },\r\n    _fetchEmitters: function(e) {\r\n        this._activeEmitters = this._emittersSet.slice();\r\n        this._applyToEmitters(\"start\", e)\r\n    },\r\n    _pointerMoveHandler: function(e) {\r\n        this._applyToEmitters(\"move\", e)\r\n    },\r\n    _pointerUpHandler: function(e) {\r\n        this._updateEmitters(e)\r\n    },\r\n    _mouseWheelHandler: function(e) {\r\n        if (!this._allowInterruptionByMouseWheel()) {\r\n            return\r\n        }\r\n        e.pointers = [null];\r\n        this._pointerDownHandler(e);\r\n        this._adjustWheelEvent(e);\r\n        this._pointerMoveHandler(e);\r\n        e.pointers = [];\r\n        this._pointerUpHandler(e)\r\n    },\r\n    _allowInterruptionByMouseWheel: function() {\r\n        var allowInterruption = true;\r\n        this._eachEmitter(function(emitter) {\r\n            allowInterruption = emitter.allowInterruptionByMouseWheel() && allowInterruption;\r\n            return allowInterruption\r\n        });\r\n        return allowInterruption\r\n    },\r\n    _adjustWheelEvent: function(e) {\r\n        var closestGestureEmitter = null;\r\n        this._eachEmitter(function(emitter) {\r\n            if (!emitter.gesture) {\r\n                return\r\n            }\r\n            var direction = emitter.getDirection(e);\r\n            if (\"horizontal\" !== direction && !e.shiftKey || \"vertical\" !== direction && e.shiftKey) {\r\n                closestGestureEmitter = emitter;\r\n                return false\r\n            }\r\n        });\r\n        if (!closestGestureEmitter) {\r\n            return\r\n        }\r\n        var direction = closestGestureEmitter.getDirection(e),\r\n            verticalGestureDirection = \"both\" === direction && !e.shiftKey || \"vertical\" === direction,\r\n            prop = verticalGestureDirection ? \"pageY\" : \"pageX\";\r\n        e[prop] += e.delta\r\n    },\r\n    isActive: function(element) {\r\n        var result = false;\r\n        this._eachEmitter(function(emitter) {\r\n            result = result || emitter.getElement().is(element)\r\n        });\r\n        return result\r\n    }\r\n});\r\nvar eventManager = new EventManager;\r\nvar EMITTER_SUBSCRIPTION_DATA = \"dxEmitterSubscription\";\r\nvar registerEmitter = function(emitterConfig) {\r\n    var emitterClass = emitterConfig.emitter,\r\n        emitterName = emitterConfig.events[0],\r\n        emitterEvents = emitterConfig.events;\r\n    each(emitterEvents, function(_, eventName) {\r\n        registerEvent(eventName, {\r\n            noBubble: !emitterConfig.bubble,\r\n            setup: function(element) {\r\n                var subscriptions = dataUtils.data(element, EMITTER_SUBSCRIPTION_DATA) || {},\r\n                    emitters = dataUtils.data(element, EMITTER_DATA) || {},\r\n                    emitter = emitters[emitterName] || new emitterClass(element);\r\n                subscriptions[eventName] = true;\r\n                emitters[emitterName] = emitter;\r\n                dataUtils.data(element, EMITTER_DATA, emitters);\r\n                dataUtils.data(element, EMITTER_SUBSCRIPTION_DATA, subscriptions)\r\n            },\r\n            add: function(element, handleObj) {\r\n                var emitters = dataUtils.data(element, EMITTER_DATA),\r\n                    emitter = emitters[emitterName];\r\n                emitter.configure(extend({\r\n                    delegateSelector: handleObj.selector\r\n                }, handleObj.data), handleObj.type)\r\n            },\r\n            teardown: function(element) {\r\n                var subscriptions = dataUtils.data(element, EMITTER_SUBSCRIPTION_DATA),\r\n                    emitters = dataUtils.data(element, EMITTER_DATA),\r\n                    emitter = emitters[emitterName];\r\n                delete subscriptions[eventName];\r\n                var disposeEmitter = true;\r\n                each(emitterEvents, function(_, eventName) {\r\n                    disposeEmitter = disposeEmitter && !subscriptions[eventName];\r\n                    return disposeEmitter\r\n                });\r\n                if (disposeEmitter) {\r\n                    if (eventManager.isActive(element)) {\r\n                        eventManager.resetEmitter(emitter)\r\n                    }\r\n                    emitter && emitter.dispose();\r\n                    delete emitters[emitterName]\r\n                }\r\n            }\r\n        })\r\n    })\r\n};\r\nmodule.exports = registerEmitter;\r\n"]},"metadata":{},"sourceType":"script"}