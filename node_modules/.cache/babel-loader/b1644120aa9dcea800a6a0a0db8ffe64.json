{"ast":null,"code":"/**\r\n * DevExtreme (ui/selection/selection.strategy.standard.js)\r\n * Version: 18.2.13\r\n * Build date: Wed May 27 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar commonUtils = require(\"../../core/utils/common\"),\n    typeUtils = require(\"../../core/utils/type\"),\n    getKeyHash = commonUtils.getKeyHash,\n    dataQuery = require(\"../../data/query\"),\n    deferredUtils = require(\"../../core/utils/deferred\"),\n    SelectionFilterCreator = require(\"../../core/utils/selection_filter\").SelectionFilterCreator,\n    when = deferredUtils.when,\n    Deferred = deferredUtils.Deferred,\n    errors = require(\"../widget/ui.errors\"),\n    SelectionStrategy = require(\"./selection.strategy\");\n\nmodule.exports = SelectionStrategy.inherit({\n  ctor: function (options) {\n    this.callBase(options);\n\n    this._initSelectedItemKeyHash();\n  },\n  _initSelectedItemKeyHash: function () {\n    this._setOption(\"keyHashIndices\", this.options.equalByReference ? null : {});\n  },\n  getSelectedItemKeys: function () {\n    return this.options.selectedItemKeys.slice(0);\n  },\n  getSelectedItems: function () {\n    return this.options.selectedItems.slice(0);\n  },\n  _preserveSelectionUpdate: function (items, isDeselect) {\n    var keyIndicesToRemoveMap,\n        keyIndex,\n        i,\n        keyOf = this.options.keyOf;\n\n    if (!keyOf) {\n      return;\n    }\n\n    var isBatchDeselect = isDeselect && items.length > 1 && !this.options.equalByReference;\n\n    if (isBatchDeselect) {\n      keyIndicesToRemoveMap = {};\n    }\n\n    for (i = 0; i < items.length; i++) {\n      var item = items[i],\n          key = keyOf(item);\n\n      if (isDeselect) {\n        keyIndex = this.removeSelectedItem(key, keyIndicesToRemoveMap);\n\n        if (keyIndicesToRemoveMap && keyIndex >= 0) {\n          keyIndicesToRemoveMap[keyIndex] = true;\n        }\n      } else {\n        this.addSelectedItem(key, item);\n      }\n    }\n\n    if (isBatchDeselect) {\n      this._batchRemoveSelectedItems(keyIndicesToRemoveMap);\n    }\n  },\n  _batchRemoveSelectedItems: function (keyIndicesToRemoveMap) {\n    var selectedItemKeys = this.options.selectedItemKeys.slice(0);\n    var selectedItems = this.options.selectedItems.slice(0);\n    this.options.selectedItemKeys.length = 0;\n    this.options.selectedItems.length = 0;\n\n    for (var i = 0; i < selectedItemKeys.length; i++) {\n      if (!keyIndicesToRemoveMap[i]) {\n        this.options.selectedItemKeys.push(selectedItemKeys[i]);\n        this.options.selectedItems.push(selectedItems[i]);\n      }\n    }\n\n    this._initSelectedItemKeyHash();\n\n    this.updateSelectedItemKeyHash(this.options.selectedItemKeys);\n  },\n  _loadSelectedItemsCore: function (keys, isDeselect, isSelectAll) {\n    var deferred = new Deferred(),\n        key = this.options.key();\n\n    if (!keys.length && !isSelectAll) {\n      deferred.resolve([]);\n      return deferred;\n    }\n\n    var filter = this.options.filter();\n\n    if (isSelectAll && isDeselect && !filter) {\n      deferred.resolve(this.getSelectedItems());\n      return deferred;\n    }\n\n    var selectionFilterCreator = new SelectionFilterCreator(keys, isSelectAll),\n        combinedFilter = selectionFilterCreator.getCombinedFilter(key, filter);\n    var deselectedItems = [];\n\n    if (isDeselect) {\n      deselectedItems = combinedFilter ? dataQuery(this.options.selectedItems).filter(combinedFilter).toArray() : this.options.selectedItems.slice(0);\n    }\n\n    var filteredItems = deselectedItems.length ? deselectedItems : this.options.plainItems(true).filter(this.options.isSelectableItem).map(this.options.getItemData);\n    var localFilter = selectionFilterCreator.getLocalFilter(this.options.keyOf, this.equalKeys.bind(this), this.options.equalByReference, key);\n    filteredItems = filteredItems.filter(localFilter);\n\n    if (deselectedItems.length || !isSelectAll && filteredItems.length === keys.length) {\n      deferred.resolve(filteredItems);\n    } else {\n      deferred = this._loadFilteredData(combinedFilter, localFilter);\n    }\n\n    return deferred;\n  },\n  _replaceSelectionUpdate: function (items) {\n    var internalKeys = [],\n        keyOf = this.options.keyOf;\n\n    if (!keyOf) {\n      return;\n    }\n\n    for (var i = 0; i < items.length; i++) {\n      var item = items[i],\n          key = keyOf(item);\n      internalKeys.push(key);\n    }\n\n    this.setSelectedItems(internalKeys, items);\n  },\n  _warnOnIncorrectKeys: function (keys) {\n    for (var i = 0; i < keys.length; i++) {\n      if (!this.isItemKeySelected(keys[i])) {\n        errors.log(\"W1002\", keys[i]);\n      }\n    }\n  },\n  _loadSelectedItems: function (keys, isDeselect, isSelectAll) {\n    var that = this,\n        deferred = new Deferred();\n    when(that._lastLoadDeferred).always(function () {\n      that._loadSelectedItemsCore(keys, isDeselect, isSelectAll).done(deferred.resolve).fail(deferred.reject);\n    });\n    that._lastLoadDeferred = deferred;\n    return deferred;\n  },\n  selectedItemKeys: function (keys, preserve, isDeselect, isSelectAll) {\n    var that = this,\n        deferred = that._loadSelectedItems(keys, isDeselect, isSelectAll);\n\n    deferred.done(function (items) {\n      if (preserve) {\n        that._preserveSelectionUpdate(items, isDeselect);\n      } else {\n        that._replaceSelectionUpdate(items);\n      }\n\n      that.onSelectionChanged();\n    });\n    return deferred;\n  },\n  addSelectedItem: function (key, itemData) {\n    var keyHash = this._getKeyHash(key);\n\n    if (this._indexOfSelectedItemKey(keyHash) === -1) {\n      if (!typeUtils.isObject(keyHash) && this.options.keyHashIndices) {\n        this.options.keyHashIndices[keyHash] = [this.options.selectedItemKeys.length];\n      }\n\n      this.options.selectedItemKeys.push(key);\n      this.options.addedItemKeys.push(key);\n      this.options.addedItems.push(itemData);\n      this.options.selectedItems.push(itemData);\n    }\n  },\n  _getSelectedIndexByKey: function (key, ignoreIndicesMap) {\n    var selectedItemKeys = this.options.selectedItemKeys;\n\n    for (var index = 0; index < selectedItemKeys.length; index++) {\n      if ((!ignoreIndicesMap || !ignoreIndicesMap[index]) && this.equalKeys(selectedItemKeys[index], key)) {\n        return index;\n      }\n    }\n\n    return -1;\n  },\n  _getSelectedIndexByHash: function (key, ignoreIndicesMap) {\n    var indices = this.options.keyHashIndices[key];\n\n    if (indices && indices.length > 1 && ignoreIndicesMap) {\n      indices = indices.filter(function (index) {\n        return !ignoreIndicesMap[index];\n      });\n    }\n\n    return indices && indices[0] >= 0 ? indices[0] : -1;\n  },\n  _indexOfSelectedItemKey: function (key, ignoreIndicesMap) {\n    var selectedIndex;\n\n    if (this.options.equalByReference) {\n      selectedIndex = this.options.selectedItemKeys.indexOf(key);\n    } else {\n      if (typeUtils.isObject(key)) {\n        selectedIndex = this._getSelectedIndexByKey(key, ignoreIndicesMap);\n      } else {\n        selectedIndex = this._getSelectedIndexByHash(key, ignoreIndicesMap);\n      }\n    }\n\n    return selectedIndex;\n  },\n  _shiftSelectedKeyIndices: function (keyIndex) {\n    for (var currentKeyIndex = keyIndex; currentKeyIndex < this.options.selectedItemKeys.length; currentKeyIndex++) {\n      var currentKey = this.options.selectedItemKeys[currentKeyIndex],\n          currentKeyHash = getKeyHash(currentKey),\n          currentKeyIndices = this.options.keyHashIndices[currentKeyHash];\n\n      if (!currentKeyIndices) {\n        continue;\n      }\n\n      for (var i = 0; i < currentKeyIndices.length; i++) {\n        if (currentKeyIndices[i] > keyIndex) {\n          currentKeyIndices[i]--;\n        }\n      }\n    }\n  },\n  removeSelectedItem: function (key, keyIndicesToRemoveMap) {\n    var keyHash = this._getKeyHash(key),\n        isBatchDeselect = !!keyIndicesToRemoveMap,\n        keyIndex = this._indexOfSelectedItemKey(keyHash, keyIndicesToRemoveMap);\n\n    if (keyIndex < 0) {\n      return keyIndex;\n    }\n\n    this.options.removedItemKeys.push(key);\n    this.options.removedItems.push(this.options.selectedItems[keyIndex]);\n\n    if (isBatchDeselect) {\n      return keyIndex;\n    }\n\n    this.options.selectedItemKeys.splice(keyIndex, 1);\n    this.options.selectedItems.splice(keyIndex, 1);\n\n    if (typeUtils.isObject(keyHash) || !this.options.keyHashIndices) {\n      return keyIndex;\n    }\n\n    var keyIndices = this.options.keyHashIndices[keyHash];\n\n    if (!keyIndices) {\n      return keyIndex;\n    }\n\n    keyIndices.shift();\n\n    if (!keyIndices.length) {\n      delete this.options.keyHashIndices[keyHash];\n    }\n\n    this._shiftSelectedKeyIndices(keyIndex);\n\n    return keyIndex;\n  },\n  _updateAddedItemKeys: function (keys, items) {\n    for (var i = 0; i < keys.length; i++) {\n      if (!this.isItemKeySelected(keys[i])) {\n        this.options.addedItemKeys.push(keys[i]);\n        this.options.addedItems.push(items[i]);\n      }\n    }\n  },\n  _updateRemovedItemKeys: function (keys, oldSelectedKeys, oldSelectedItems) {\n    for (var i = 0; i < oldSelectedKeys.length; i++) {\n      if (!this.isItemKeySelected(oldSelectedKeys[i])) {\n        this.options.removedItemKeys.push(oldSelectedKeys[i]);\n        this.options.removedItems.push(oldSelectedItems[i]);\n      }\n    }\n  },\n  _getKeyHash: function (key) {\n    return this.options.equalByReference ? key : getKeyHash(key);\n  },\n  setSelectedItems: function (keys, items) {\n    this._updateAddedItemKeys(keys, items);\n\n    var oldSelectedKeys = this.options.selectedItemKeys,\n        oldSelectedItems = this.options.selectedItems;\n\n    if (!this.options.equalByReference) {\n      this._initSelectedItemKeyHash();\n\n      this.updateSelectedItemKeyHash(keys);\n    }\n\n    this._setOption(\"selectedItemKeys\", keys);\n\n    this._setOption(\"selectedItems\", items);\n\n    this._updateRemovedItemKeys(keys, oldSelectedKeys, oldSelectedItems);\n  },\n  isItemDataSelected: function (itemData) {\n    var key = this.options.keyOf(itemData);\n    return this.isItemKeySelected(key);\n  },\n  isItemKeySelected: function (key) {\n    var keyHash = this._getKeyHash(key);\n\n    var index = this._indexOfSelectedItemKey(keyHash);\n\n    return index !== -1;\n  },\n  getSelectAllState: function (visibleOnly) {\n    if (visibleOnly) {\n      return this._getVisibleSelectAllState();\n    } else {\n      return this._getFullSelectAllState();\n    }\n  }\n});","map":{"version":3,"sources":["C:/Users/abdel/PhpstormProjects/editeur_scenario_jeu/node_modules/devextreme/ui/selection/selection.strategy.standard.js"],"names":["commonUtils","require","typeUtils","getKeyHash","dataQuery","deferredUtils","SelectionFilterCreator","when","Deferred","errors","SelectionStrategy","module","exports","inherit","ctor","options","callBase","_initSelectedItemKeyHash","_setOption","equalByReference","getSelectedItemKeys","selectedItemKeys","slice","getSelectedItems","selectedItems","_preserveSelectionUpdate","items","isDeselect","keyIndicesToRemoveMap","keyIndex","i","keyOf","isBatchDeselect","length","item","key","removeSelectedItem","addSelectedItem","_batchRemoveSelectedItems","push","updateSelectedItemKeyHash","_loadSelectedItemsCore","keys","isSelectAll","deferred","resolve","filter","selectionFilterCreator","combinedFilter","getCombinedFilter","deselectedItems","toArray","filteredItems","plainItems","isSelectableItem","map","getItemData","localFilter","getLocalFilter","equalKeys","bind","_loadFilteredData","_replaceSelectionUpdate","internalKeys","setSelectedItems","_warnOnIncorrectKeys","isItemKeySelected","log","_loadSelectedItems","that","_lastLoadDeferred","always","done","fail","reject","preserve","onSelectionChanged","itemData","keyHash","_getKeyHash","_indexOfSelectedItemKey","isObject","keyHashIndices","addedItemKeys","addedItems","_getSelectedIndexByKey","ignoreIndicesMap","index","_getSelectedIndexByHash","indices","selectedIndex","indexOf","_shiftSelectedKeyIndices","currentKeyIndex","currentKey","currentKeyHash","currentKeyIndices","removedItemKeys","removedItems","splice","keyIndices","shift","_updateAddedItemKeys","_updateRemovedItemKeys","oldSelectedKeys","oldSelectedItems","isItemDataSelected","getSelectAllState","visibleOnly","_getVisibleSelectAllState","_getFullSelectAllState"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/selection/selection.strategy.standard.js)\r\n * Version: 18.2.13\r\n * Build date: Wed May 27 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar commonUtils = require(\"../../core/utils/common\"),\r\n    typeUtils = require(\"../../core/utils/type\"),\r\n    getKeyHash = commonUtils.getKeyHash,\r\n    dataQuery = require(\"../../data/query\"),\r\n    deferredUtils = require(\"../../core/utils/deferred\"),\r\n    SelectionFilterCreator = require(\"../../core/utils/selection_filter\").SelectionFilterCreator,\r\n    when = deferredUtils.when,\r\n    Deferred = deferredUtils.Deferred,\r\n    errors = require(\"../widget/ui.errors\"),\r\n    SelectionStrategy = require(\"./selection.strategy\");\r\nmodule.exports = SelectionStrategy.inherit({\r\n    ctor: function(options) {\r\n        this.callBase(options);\r\n        this._initSelectedItemKeyHash()\r\n    },\r\n    _initSelectedItemKeyHash: function() {\r\n        this._setOption(\"keyHashIndices\", this.options.equalByReference ? null : {})\r\n    },\r\n    getSelectedItemKeys: function() {\r\n        return this.options.selectedItemKeys.slice(0)\r\n    },\r\n    getSelectedItems: function() {\r\n        return this.options.selectedItems.slice(0)\r\n    },\r\n    _preserveSelectionUpdate: function(items, isDeselect) {\r\n        var keyIndicesToRemoveMap, keyIndex, i, keyOf = this.options.keyOf;\r\n        if (!keyOf) {\r\n            return\r\n        }\r\n        var isBatchDeselect = isDeselect && items.length > 1 && !this.options.equalByReference;\r\n        if (isBatchDeselect) {\r\n            keyIndicesToRemoveMap = {}\r\n        }\r\n        for (i = 0; i < items.length; i++) {\r\n            var item = items[i],\r\n                key = keyOf(item);\r\n            if (isDeselect) {\r\n                keyIndex = this.removeSelectedItem(key, keyIndicesToRemoveMap);\r\n                if (keyIndicesToRemoveMap && keyIndex >= 0) {\r\n                    keyIndicesToRemoveMap[keyIndex] = true\r\n                }\r\n            } else {\r\n                this.addSelectedItem(key, item)\r\n            }\r\n        }\r\n        if (isBatchDeselect) {\r\n            this._batchRemoveSelectedItems(keyIndicesToRemoveMap)\r\n        }\r\n    },\r\n    _batchRemoveSelectedItems: function(keyIndicesToRemoveMap) {\r\n        var selectedItemKeys = this.options.selectedItemKeys.slice(0);\r\n        var selectedItems = this.options.selectedItems.slice(0);\r\n        this.options.selectedItemKeys.length = 0;\r\n        this.options.selectedItems.length = 0;\r\n        for (var i = 0; i < selectedItemKeys.length; i++) {\r\n            if (!keyIndicesToRemoveMap[i]) {\r\n                this.options.selectedItemKeys.push(selectedItemKeys[i]);\r\n                this.options.selectedItems.push(selectedItems[i])\r\n            }\r\n        }\r\n        this._initSelectedItemKeyHash();\r\n        this.updateSelectedItemKeyHash(this.options.selectedItemKeys)\r\n    },\r\n    _loadSelectedItemsCore: function(keys, isDeselect, isSelectAll) {\r\n        var deferred = new Deferred,\r\n            key = this.options.key();\r\n        if (!keys.length && !isSelectAll) {\r\n            deferred.resolve([]);\r\n            return deferred\r\n        }\r\n        var filter = this.options.filter();\r\n        if (isSelectAll && isDeselect && !filter) {\r\n            deferred.resolve(this.getSelectedItems());\r\n            return deferred\r\n        }\r\n        var selectionFilterCreator = new SelectionFilterCreator(keys, isSelectAll),\r\n            combinedFilter = selectionFilterCreator.getCombinedFilter(key, filter);\r\n        var deselectedItems = [];\r\n        if (isDeselect) {\r\n            deselectedItems = combinedFilter ? dataQuery(this.options.selectedItems).filter(combinedFilter).toArray() : this.options.selectedItems.slice(0)\r\n        }\r\n        var filteredItems = deselectedItems.length ? deselectedItems : this.options.plainItems(true).filter(this.options.isSelectableItem).map(this.options.getItemData);\r\n        var localFilter = selectionFilterCreator.getLocalFilter(this.options.keyOf, this.equalKeys.bind(this), this.options.equalByReference, key);\r\n        filteredItems = filteredItems.filter(localFilter);\r\n        if (deselectedItems.length || !isSelectAll && filteredItems.length === keys.length) {\r\n            deferred.resolve(filteredItems)\r\n        } else {\r\n            deferred = this._loadFilteredData(combinedFilter, localFilter)\r\n        }\r\n        return deferred\r\n    },\r\n    _replaceSelectionUpdate: function(items) {\r\n        var internalKeys = [],\r\n            keyOf = this.options.keyOf;\r\n        if (!keyOf) {\r\n            return\r\n        }\r\n        for (var i = 0; i < items.length; i++) {\r\n            var item = items[i],\r\n                key = keyOf(item);\r\n            internalKeys.push(key)\r\n        }\r\n        this.setSelectedItems(internalKeys, items)\r\n    },\r\n    _warnOnIncorrectKeys: function(keys) {\r\n        for (var i = 0; i < keys.length; i++) {\r\n            if (!this.isItemKeySelected(keys[i])) {\r\n                errors.log(\"W1002\", keys[i])\r\n            }\r\n        }\r\n    },\r\n    _loadSelectedItems: function(keys, isDeselect, isSelectAll) {\r\n        var that = this,\r\n            deferred = new Deferred;\r\n        when(that._lastLoadDeferred).always(function() {\r\n            that._loadSelectedItemsCore(keys, isDeselect, isSelectAll).done(deferred.resolve).fail(deferred.reject)\r\n        });\r\n        that._lastLoadDeferred = deferred;\r\n        return deferred\r\n    },\r\n    selectedItemKeys: function(keys, preserve, isDeselect, isSelectAll) {\r\n        var that = this,\r\n            deferred = that._loadSelectedItems(keys, isDeselect, isSelectAll);\r\n        deferred.done(function(items) {\r\n            if (preserve) {\r\n                that._preserveSelectionUpdate(items, isDeselect)\r\n            } else {\r\n                that._replaceSelectionUpdate(items)\r\n            }\r\n            that.onSelectionChanged()\r\n        });\r\n        return deferred\r\n    },\r\n    addSelectedItem: function(key, itemData) {\r\n        var keyHash = this._getKeyHash(key);\r\n        if (this._indexOfSelectedItemKey(keyHash) === -1) {\r\n            if (!typeUtils.isObject(keyHash) && this.options.keyHashIndices) {\r\n                this.options.keyHashIndices[keyHash] = [this.options.selectedItemKeys.length]\r\n            }\r\n            this.options.selectedItemKeys.push(key);\r\n            this.options.addedItemKeys.push(key);\r\n            this.options.addedItems.push(itemData);\r\n            this.options.selectedItems.push(itemData)\r\n        }\r\n    },\r\n    _getSelectedIndexByKey: function(key, ignoreIndicesMap) {\r\n        var selectedItemKeys = this.options.selectedItemKeys;\r\n        for (var index = 0; index < selectedItemKeys.length; index++) {\r\n            if ((!ignoreIndicesMap || !ignoreIndicesMap[index]) && this.equalKeys(selectedItemKeys[index], key)) {\r\n                return index\r\n            }\r\n        }\r\n        return -1\r\n    },\r\n    _getSelectedIndexByHash: function(key, ignoreIndicesMap) {\r\n        var indices = this.options.keyHashIndices[key];\r\n        if (indices && indices.length > 1 && ignoreIndicesMap) {\r\n            indices = indices.filter(function(index) {\r\n                return !ignoreIndicesMap[index]\r\n            })\r\n        }\r\n        return indices && indices[0] >= 0 ? indices[0] : -1\r\n    },\r\n    _indexOfSelectedItemKey: function(key, ignoreIndicesMap) {\r\n        var selectedIndex;\r\n        if (this.options.equalByReference) {\r\n            selectedIndex = this.options.selectedItemKeys.indexOf(key)\r\n        } else {\r\n            if (typeUtils.isObject(key)) {\r\n                selectedIndex = this._getSelectedIndexByKey(key, ignoreIndicesMap)\r\n            } else {\r\n                selectedIndex = this._getSelectedIndexByHash(key, ignoreIndicesMap)\r\n            }\r\n        }\r\n        return selectedIndex\r\n    },\r\n    _shiftSelectedKeyIndices: function(keyIndex) {\r\n        for (var currentKeyIndex = keyIndex; currentKeyIndex < this.options.selectedItemKeys.length; currentKeyIndex++) {\r\n            var currentKey = this.options.selectedItemKeys[currentKeyIndex],\r\n                currentKeyHash = getKeyHash(currentKey),\r\n                currentKeyIndices = this.options.keyHashIndices[currentKeyHash];\r\n            if (!currentKeyIndices) {\r\n                continue\r\n            }\r\n            for (var i = 0; i < currentKeyIndices.length; i++) {\r\n                if (currentKeyIndices[i] > keyIndex) {\r\n                    currentKeyIndices[i]--\r\n                }\r\n            }\r\n        }\r\n    },\r\n    removeSelectedItem: function(key, keyIndicesToRemoveMap) {\r\n        var keyHash = this._getKeyHash(key),\r\n            isBatchDeselect = !!keyIndicesToRemoveMap,\r\n            keyIndex = this._indexOfSelectedItemKey(keyHash, keyIndicesToRemoveMap);\r\n        if (keyIndex < 0) {\r\n            return keyIndex\r\n        }\r\n        this.options.removedItemKeys.push(key);\r\n        this.options.removedItems.push(this.options.selectedItems[keyIndex]);\r\n        if (isBatchDeselect) {\r\n            return keyIndex\r\n        }\r\n        this.options.selectedItemKeys.splice(keyIndex, 1);\r\n        this.options.selectedItems.splice(keyIndex, 1);\r\n        if (typeUtils.isObject(keyHash) || !this.options.keyHashIndices) {\r\n            return keyIndex\r\n        }\r\n        var keyIndices = this.options.keyHashIndices[keyHash];\r\n        if (!keyIndices) {\r\n            return keyIndex\r\n        }\r\n        keyIndices.shift();\r\n        if (!keyIndices.length) {\r\n            delete this.options.keyHashIndices[keyHash]\r\n        }\r\n        this._shiftSelectedKeyIndices(keyIndex);\r\n        return keyIndex\r\n    },\r\n    _updateAddedItemKeys: function(keys, items) {\r\n        for (var i = 0; i < keys.length; i++) {\r\n            if (!this.isItemKeySelected(keys[i])) {\r\n                this.options.addedItemKeys.push(keys[i]);\r\n                this.options.addedItems.push(items[i])\r\n            }\r\n        }\r\n    },\r\n    _updateRemovedItemKeys: function(keys, oldSelectedKeys, oldSelectedItems) {\r\n        for (var i = 0; i < oldSelectedKeys.length; i++) {\r\n            if (!this.isItemKeySelected(oldSelectedKeys[i])) {\r\n                this.options.removedItemKeys.push(oldSelectedKeys[i]);\r\n                this.options.removedItems.push(oldSelectedItems[i])\r\n            }\r\n        }\r\n    },\r\n    _getKeyHash: function(key) {\r\n        return this.options.equalByReference ? key : getKeyHash(key)\r\n    },\r\n    setSelectedItems: function(keys, items) {\r\n        this._updateAddedItemKeys(keys, items);\r\n        var oldSelectedKeys = this.options.selectedItemKeys,\r\n            oldSelectedItems = this.options.selectedItems;\r\n        if (!this.options.equalByReference) {\r\n            this._initSelectedItemKeyHash();\r\n            this.updateSelectedItemKeyHash(keys)\r\n        }\r\n        this._setOption(\"selectedItemKeys\", keys);\r\n        this._setOption(\"selectedItems\", items);\r\n        this._updateRemovedItemKeys(keys, oldSelectedKeys, oldSelectedItems)\r\n    },\r\n    isItemDataSelected: function(itemData) {\r\n        var key = this.options.keyOf(itemData);\r\n        return this.isItemKeySelected(key)\r\n    },\r\n    isItemKeySelected: function(key) {\r\n        var keyHash = this._getKeyHash(key);\r\n        var index = this._indexOfSelectedItemKey(keyHash);\r\n        return index !== -1\r\n    },\r\n    getSelectAllState: function(visibleOnly) {\r\n        if (visibleOnly) {\r\n            return this._getVisibleSelectAllState()\r\n        } else {\r\n            return this._getFullSelectAllState()\r\n        }\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"script"}