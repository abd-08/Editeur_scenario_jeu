{"ast":null,"code":"/**\r\n * DevExtreme (data/array_utils.js)\r\n * Version: 18.2.13\r\n * Build date: Wed May 27 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _typeof = \"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\nvar _type = require(\"../core/utils/type\");\n\nvar _config = require(\"../core/config\");\n\nvar _config2 = _interopRequireDefault(_config);\n\nvar _guid = require(\"../core/guid\");\n\nvar _guid2 = _interopRequireDefault(_guid);\n\nvar _extend = require(\"../core/utils/extend\");\n\nvar _errors = require(\"./errors\");\n\nvar _object = require(\"../core/utils/object\");\n\nvar _object2 = _interopRequireDefault(_object);\n\nvar _utils = require(\"./utils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction hasKey(target, keyOrKeys) {\n  var key,\n      keys = \"string\" === typeof keyOrKeys ? keyOrKeys.split() : keyOrKeys.slice();\n\n  while (keys.length) {\n    key = keys.shift();\n\n    if (key in target) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction findItems(keyInfo, items, key, groupCount) {\n  var childItems, result;\n\n  if (groupCount) {\n    for (var i = 0; i < items.length; i++) {\n      childItems = items[i].items || items[i].collapsedItems || [];\n      result = findItems(keyInfo, childItems || [], key, groupCount - 1);\n\n      if (result) {\n        return result;\n      }\n    }\n  } else {\n    if (indexByKey(keyInfo, items, key) >= 0) {\n      return items;\n    }\n  }\n}\n\nfunction getItems(keyInfo, items, key, groupCount) {\n  if (groupCount) {\n    return findItems(keyInfo, items, key, groupCount) || [];\n  }\n\n  return items;\n}\n\nfunction generateHasKeyCache(keyInfo, array) {\n  if (keyInfo.key() && !array._hasKeyMap) {\n    var hasKeyMap = {};\n\n    for (var i = 0, arrayLength = array.length; i < arrayLength; i++) {\n      hasKeyMap[JSON.stringify(keyInfo.keyOf(array[i]))] = true;\n    }\n\n    array._hasKeyMap = hasKeyMap;\n  }\n}\n\nfunction getHasKeyCacheValue(array, key) {\n  if (array._hasKeyMap) {\n    return array._hasKeyMap[JSON.stringify(key)];\n  }\n\n  return true;\n}\n\nfunction setHasKeyCacheValue(array, key) {\n  if (array._hasKeyMap) {\n    array._hasKeyMap[JSON.stringify(key)] = true;\n  }\n}\n\nfunction applyBatch(keyInfo, array, batchData, groupCount, useInsertIndex) {\n  batchData.forEach(function (item) {\n    var items = \"insert\" === item.type ? array : getItems(keyInfo, array, item.key, groupCount);\n    generateHasKeyCache(keyInfo, items);\n\n    switch (item.type) {\n      case \"update\":\n        update(keyInfo, items, item.key, item.data, true);\n        break;\n\n      case \"insert\":\n        insert(keyInfo, items, item.data, useInsertIndex && (0, _type.isDefined)(item.index) ? item.index : -1, true);\n        break;\n\n      case \"remove\":\n        remove(keyInfo, items, item.key, true);\n    }\n  });\n}\n\nfunction update(keyInfo, array, key, data, isBatch) {\n  var target,\n      extendComplexObject = true,\n      keyExpr = keyInfo.key();\n\n  if (keyExpr) {\n    if (hasKey(data, keyExpr) && !(0, _utils.keysEqual)(keyExpr, key, keyInfo.keyOf(data))) {\n      return !isBatch && (0, _utils.rejectedPromise)(_errors.errors.Error(\"E4017\"));\n    }\n\n    var index = indexByKey(keyInfo, array, key);\n\n    if (index < 0) {\n      return !isBatch && (0, _utils.rejectedPromise)(_errors.errors.Error(\"E4009\"));\n    }\n\n    target = array[index];\n  } else {\n    target = key;\n  }\n\n  _object2.default.deepExtendArraySafe(target, data, extendComplexObject);\n\n  if (!isBatch) {\n    if ((0, _config2.default)().useLegacyStoreResult) {\n      return (0, _utils.trivialPromise)(key, data);\n    } else {\n      return (0, _utils.trivialPromise)(target, key);\n    }\n  }\n}\n\nfunction insert(keyInfo, array, data, index, isBatch) {\n  var keyValue,\n      obj,\n      keyExpr = keyInfo.key();\n  obj = (0, _type.isPlainObject)(data) ? (0, _extend.extend)({}, data) : data;\n\n  if (keyExpr) {\n    keyValue = keyInfo.keyOf(obj);\n\n    if (void 0 === keyValue || \"object\" === (\"undefined\" === typeof keyValue ? \"undefined\" : _typeof(keyValue)) && (0, _type.isEmptyObject)(keyValue)) {\n      if (Array.isArray(keyExpr)) {\n        throw _errors.errors.Error(\"E4007\");\n      }\n\n      keyValue = obj[keyExpr] = String(new _guid2.default());\n    } else {\n      if (void 0 !== array[indexByKey(keyInfo, array, keyValue)]) {\n        return !isBatch && (0, _utils.rejectedPromise)(_errors.errors.Error(\"E4008\"));\n      }\n    }\n  } else {\n    keyValue = obj;\n  }\n\n  if (index >= 0) {\n    array.splice(index, 0, obj);\n  } else {\n    array.push(obj);\n  }\n\n  setHasKeyCacheValue(array, keyValue);\n\n  if (!isBatch) {\n    return (0, _utils.trivialPromise)((0, _config2.default)().useLegacyStoreResult ? data : obj, keyValue);\n  }\n}\n\nfunction remove(keyInfo, array, key, isBatch) {\n  var index = indexByKey(keyInfo, array, key);\n\n  if (index > -1) {\n    array.splice(index, 1);\n  }\n\n  if (!isBatch) {\n    return (0, _utils.trivialPromise)(key);\n  }\n}\n\nfunction indexByKey(keyInfo, array, key) {\n  var keyExpr = keyInfo.key();\n\n  if (!getHasKeyCacheValue(array, key)) {\n    return -1;\n  }\n\n  for (var i = 0, arrayLength = array.length; i < arrayLength; i++) {\n    if ((0, _utils.keysEqual)(keyExpr, keyInfo.keyOf(array[i]), key)) {\n      return i;\n    }\n  }\n\n  return -1;\n}\n\nmodule.exports.applyBatch = applyBatch;\nmodule.exports.update = update;\nmodule.exports.insert = insert;\nmodule.exports.remove = remove;\nmodule.exports.indexByKey = indexByKey;","map":{"version":3,"sources":["C:/Users/abdel/PhpstormProjects/editeur_scenario_jeu/node_modules/devextreme/data/array_utils.js"],"names":["_typeof","Symbol","iterator","obj","constructor","prototype","_type","require","_config","_config2","_interopRequireDefault","_guid","_guid2","_extend","_errors","_object","_object2","_utils","__esModule","hasKey","target","keyOrKeys","key","keys","split","slice","length","shift","findItems","keyInfo","items","groupCount","childItems","result","i","collapsedItems","indexByKey","getItems","generateHasKeyCache","array","_hasKeyMap","hasKeyMap","arrayLength","JSON","stringify","keyOf","getHasKeyCacheValue","setHasKeyCacheValue","applyBatch","batchData","useInsertIndex","forEach","item","type","update","data","insert","isDefined","index","remove","isBatch","extendComplexObject","keyExpr","keysEqual","rejectedPromise","errors","Error","default","deepExtendArraySafe","useLegacyStoreResult","trivialPromise","keyValue","isPlainObject","extend","isEmptyObject","Array","isArray","String","splice","push","module","exports"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (data/array_utils.js)\r\n * Version: 18.2.13\r\n * Build date: Wed May 27 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _typeof = \"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator ? function(obj) {\r\n    return typeof obj\r\n} : function(obj) {\r\n    return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj\r\n};\r\nvar _type = require(\"../core/utils/type\");\r\nvar _config = require(\"../core/config\");\r\nvar _config2 = _interopRequireDefault(_config);\r\nvar _guid = require(\"../core/guid\");\r\nvar _guid2 = _interopRequireDefault(_guid);\r\nvar _extend = require(\"../core/utils/extend\");\r\nvar _errors = require(\"./errors\");\r\nvar _object = require(\"../core/utils/object\");\r\nvar _object2 = _interopRequireDefault(_object);\r\nvar _utils = require(\"./utils\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction hasKey(target, keyOrKeys) {\r\n    var key, keys = \"string\" === typeof keyOrKeys ? keyOrKeys.split() : keyOrKeys.slice();\r\n    while (keys.length) {\r\n        key = keys.shift();\r\n        if (key in target) {\r\n            return true\r\n        }\r\n    }\r\n    return false\r\n}\r\n\r\nfunction findItems(keyInfo, items, key, groupCount) {\r\n    var childItems, result;\r\n    if (groupCount) {\r\n        for (var i = 0; i < items.length; i++) {\r\n            childItems = items[i].items || items[i].collapsedItems || [];\r\n            result = findItems(keyInfo, childItems || [], key, groupCount - 1);\r\n            if (result) {\r\n                return result\r\n            }\r\n        }\r\n    } else {\r\n        if (indexByKey(keyInfo, items, key) >= 0) {\r\n            return items\r\n        }\r\n    }\r\n}\r\n\r\nfunction getItems(keyInfo, items, key, groupCount) {\r\n    if (groupCount) {\r\n        return findItems(keyInfo, items, key, groupCount) || []\r\n    }\r\n    return items\r\n}\r\n\r\nfunction generateHasKeyCache(keyInfo, array) {\r\n    if (keyInfo.key() && !array._hasKeyMap) {\r\n        var hasKeyMap = {};\r\n        for (var i = 0, arrayLength = array.length; i < arrayLength; i++) {\r\n            hasKeyMap[JSON.stringify(keyInfo.keyOf(array[i]))] = true\r\n        }\r\n        array._hasKeyMap = hasKeyMap\r\n    }\r\n}\r\n\r\nfunction getHasKeyCacheValue(array, key) {\r\n    if (array._hasKeyMap) {\r\n        return array._hasKeyMap[JSON.stringify(key)]\r\n    }\r\n    return true\r\n}\r\n\r\nfunction setHasKeyCacheValue(array, key) {\r\n    if (array._hasKeyMap) {\r\n        array._hasKeyMap[JSON.stringify(key)] = true\r\n    }\r\n}\r\n\r\nfunction applyBatch(keyInfo, array, batchData, groupCount, useInsertIndex) {\r\n    batchData.forEach(function(item) {\r\n        var items = \"insert\" === item.type ? array : getItems(keyInfo, array, item.key, groupCount);\r\n        generateHasKeyCache(keyInfo, items);\r\n        switch (item.type) {\r\n            case \"update\":\r\n                update(keyInfo, items, item.key, item.data, true);\r\n                break;\r\n            case \"insert\":\r\n                insert(keyInfo, items, item.data, useInsertIndex && (0, _type.isDefined)(item.index) ? item.index : -1, true);\r\n                break;\r\n            case \"remove\":\r\n                remove(keyInfo, items, item.key, true)\r\n        }\r\n    })\r\n}\r\n\r\nfunction update(keyInfo, array, key, data, isBatch) {\r\n    var target, extendComplexObject = true,\r\n        keyExpr = keyInfo.key();\r\n    if (keyExpr) {\r\n        if (hasKey(data, keyExpr) && !(0, _utils.keysEqual)(keyExpr, key, keyInfo.keyOf(data))) {\r\n            return !isBatch && (0, _utils.rejectedPromise)(_errors.errors.Error(\"E4017\"))\r\n        }\r\n        var index = indexByKey(keyInfo, array, key);\r\n        if (index < 0) {\r\n            return !isBatch && (0, _utils.rejectedPromise)(_errors.errors.Error(\"E4009\"))\r\n        }\r\n        target = array[index]\r\n    } else {\r\n        target = key\r\n    }\r\n    _object2.default.deepExtendArraySafe(target, data, extendComplexObject);\r\n    if (!isBatch) {\r\n        if ((0, _config2.default)().useLegacyStoreResult) {\r\n            return (0, _utils.trivialPromise)(key, data)\r\n        } else {\r\n            return (0, _utils.trivialPromise)(target, key)\r\n        }\r\n    }\r\n}\r\n\r\nfunction insert(keyInfo, array, data, index, isBatch) {\r\n    var keyValue, obj, keyExpr = keyInfo.key();\r\n    obj = (0, _type.isPlainObject)(data) ? (0, _extend.extend)({}, data) : data;\r\n    if (keyExpr) {\r\n        keyValue = keyInfo.keyOf(obj);\r\n        if (void 0 === keyValue || \"object\" === (\"undefined\" === typeof keyValue ? \"undefined\" : _typeof(keyValue)) && (0, _type.isEmptyObject)(keyValue)) {\r\n            if (Array.isArray(keyExpr)) {\r\n                throw _errors.errors.Error(\"E4007\")\r\n            }\r\n            keyValue = obj[keyExpr] = String(new _guid2.default)\r\n        } else {\r\n            if (void 0 !== array[indexByKey(keyInfo, array, keyValue)]) {\r\n                return !isBatch && (0, _utils.rejectedPromise)(_errors.errors.Error(\"E4008\"))\r\n            }\r\n        }\r\n    } else {\r\n        keyValue = obj\r\n    }\r\n    if (index >= 0) {\r\n        array.splice(index, 0, obj)\r\n    } else {\r\n        array.push(obj)\r\n    }\r\n    setHasKeyCacheValue(array, keyValue);\r\n    if (!isBatch) {\r\n        return (0, _utils.trivialPromise)((0, _config2.default)().useLegacyStoreResult ? data : obj, keyValue)\r\n    }\r\n}\r\n\r\nfunction remove(keyInfo, array, key, isBatch) {\r\n    var index = indexByKey(keyInfo, array, key);\r\n    if (index > -1) {\r\n        array.splice(index, 1)\r\n    }\r\n    if (!isBatch) {\r\n        return (0, _utils.trivialPromise)(key)\r\n    }\r\n}\r\n\r\nfunction indexByKey(keyInfo, array, key) {\r\n    var keyExpr = keyInfo.key();\r\n    if (!getHasKeyCacheValue(array, key)) {\r\n        return -1\r\n    }\r\n    for (var i = 0, arrayLength = array.length; i < arrayLength; i++) {\r\n        if ((0, _utils.keysEqual)(keyExpr, keyInfo.keyOf(array[i]), key)) {\r\n            return i\r\n        }\r\n    }\r\n    return -1\r\n}\r\nmodule.exports.applyBatch = applyBatch;\r\nmodule.exports.update = update;\r\nmodule.exports.insert = insert;\r\nmodule.exports.remove = remove;\r\nmodule.exports.indexByKey = indexByKey;\r\n"]},"metadata":{},"sourceType":"script"}