{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\abdel\\\\PhpstormProjects\\\\update\\\\src\\\\navigation\\\\Navigation.js\";\nimport React, { Component } from \"react\";\nimport TreeView from \"devextreme-react/tree-view\";\nimport * as Constants from \"../configuration_app/Constants\";\nimport { activites, selection, supprimerActivite, supprimerScenario } from \"../data/data\";\nimport { remplissageStockage, update } from \"../App\";\nimport { mise_a_jour_na, rechercheNav } from \"../fonctions/helper/NavigationHelper\";\nimport { compositions } from \"../types/TypeComposition\";\nimport { download, liste_entite } from \"../fonctions/helper/AppHelper\";\nimport { ajouterActivite } from \"../fonctions/helper/ActiviteHelper\";\nimport { ajouterTache } from \"../fonctions/helper/TacheHelper\";\nimport { ajouterQuete } from \"../fonctions/helper/QueteHelper\";\nimport { ajouterScenario } from \"../fonctions/helper/ScenarioHelper\"; //fonction qui met a jour la navigation\n\nexport function update_navigation() {\n  let nav = mise_a_jour_na();\n  this.setState({\n    p: nav\n  });\n}\n\nclass Navigation extends Component {\n  constructor(props) {\n    super(props);\n\n    this.recherche = id => {\n      // renvoie la liste des nodes et des links\n      return rechercheNav(id);\n    };\n\n    this.state = {\n      nom: 'test',\n      value: \"contains\",\n      p: []\n    };\n    this.itemClicked = this.itemClicked.bind(this);\n    update_navigation = update_navigation.bind(this);\n  }\n\n  itemClicked(e) {\n    for (let i = 0; i < selection.nodes.length; i++) selection.nodes[i].color = Constants.GRAPH_NODES_DEFAULT_COLOR;\n\n    let search = this.recherche(e.itemData.id);\n    let tab = search.tab;\n    let i = search.i;\n    selection.nodes = tab[i].nodes;\n    selection.links = tab[i].links;\n    selection.node = null;\n    selection.link = null;\n    selection.nom = tab[i].nom;\n    selection.idPere = tab[i].idPere;\n    selection.id = tab[i].id;\n    selection.description = tab[i].description;\n    selection.type = tab[i].type;\n    selection.listeEntites = liste_entite(selection);\n\n    if (tab[i].type === compositions.ACTIVITE) {\n      selection.idPere = null;\n      selection.listeEntites = tab[i].listeEntites;\n    }\n\n    update();\n    update_navigation();\n    console.log(download(selection.id));\n  }\n\n  componentWillMount() {\n    update_navigation();\n  }\n\n  supprimer() {\n    supprimerActivite(selection.id);\n\n    for (let i = 0; i < selection.nodes.length; i++) {\n      supprimerScenario(selection.nodes[i].id);\n    }\n\n    selection.id = null;\n    selection.nodes = [];\n    selection.listeEntites = [];\n    update_navigation();\n    update();\n  }\n\n  modifier() {\n    ///focntion qui modifie le nom d'une activite\n    selection.nom = 'test';\n    let search = rechercheNav(selection.id);\n    let tab = search.tab;\n    let i = search.i;\n    tab[i].nom = 'test';\n    update_navigation();\n  }\n\n  ajouter() {\n    let res = 'Activite ';\n    let nb = activites.length + 1;\n    let i = activites.findIndex(x => x.nom === res + nb);\n\n    while (i !== -1) {\n      nb = nb + 1;\n      i = activites.findIndex(x => x.nom === res + nb);\n    }\n\n    ajouterActivite(res + nb, '');\n    update_navigation();\n    remplissageStockage();\n    let monObjet = JSON.parse(localStorage.getItem(\"Activites\"));\n    console.log('json objett');\n    console.log(monObjet.length);\n  } //on gére ouverture et fermeture du modal\n\n\n  onChange(e) {\n    let files = e.target.files;\n    let reader = new FileReader();\n    console.log(files[0]);\n    reader.readAsBinaryString(files[0]); //reader.onload\n\n    console.log(reader);\n    console.log(reader.result);\n  }\n\n  previewFiles() {\n    let preview = document.querySelector('#preview');\n    let files = document.querySelector('input[type=file]').files;\n\n    function readAndPreview(file) {\n      // Veillez à ce que `file.name` corresponde à nos critères d’extension\n      if (/\\.(json|JSON)$/i.test(file.name)) {\n        let reader = new FileReader();\n        reader.addEventListener(\"load\", function () {\n          let image = new Image();\n          image.height = 100;\n          image.title = file.name;\n          image.src = this.result;\n          preview.appendChild(image);\n        }, false);\n        reader.readAsDataURL(file);\n      }\n    }\n\n    if (files) {\n      [].forEach.call(files, readAndPreview);\n    }\n  }\n\n  query(e) {\n    //var vFile = document.getElementById(\"myfile\").files[0];\n    let vFile = e.target.files[0];\n    let vReader = new FileReader();\n    vReader.readAsText(vFile);\n\n    vReader.onload = function (pEvent) {\n      // String Input\n      let vContent = pEvent.target.result;\n      console.log(vContent); // JSON to object\n\n      let vJson = JSON.parse(vContent);\n      activites.push(vJson.activite); // scenarios.push(vJson.scenarios[0]);\n      //quetes.push(vJson.quetes[0]);\n\n      ajouterScenario(vJson.scenarios[0]);\n      ajouterQuete(vJson.quetes[0]);\n      ajouterTache(vJson.taches[0]); //taches.push(vJson.taches);\n\n      console.log(vJson);\n      console.log(vJson.scenarios);\n      console.log(\"chargement terminer\");\n    };\n\n    update_navigation();\n  }\n\n  render() {\n    return React.createElement(React.Fragment, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199\n      },\n      __self: this\n    }, React.createElement(TreeView, {\n      id: \"treeview\",\n      items: this.state.p,\n      height: Constants.NAV_DEFAULT_HEIGHT,\n      width: Constants.NAV_DEFAULT_WIDTH,\n      searchMode: Constants.NAV_DEFAULT_SEARCH_MODE,\n      searchEnabled: Constants.NAV_DEFAULT_SEARCH_ENABLE,\n      selectionMode: 'single',\n      selectByClick: true,\n      onItemClick: this.itemClicked,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      onClick: this.supprimer,\n      hidden: selection.type !== compositions.ACTIVITE || activites.length === 0,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211\n      },\n      __self: this\n    }, \"del\"), React.createElement(\"button\", {\n      onClick: this.modifier,\n      hidden: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212\n      },\n      __self: this\n    }, \"mod\"), React.createElement(\"button\", {\n      onClick: this.ajouter,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213\n      },\n      __self: this\n    }, \"add\"), React.createElement(\"div\", {\n      onSubmit: this.onFormSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      type: \"file\",\n      name: \"file\",\n      accept: \".json\",\n      onChange: e => this.query(e),\n      multiple: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215\n      },\n      __self: this\n    })));\n  }\n\n}\n\nexport default Navigation;","map":{"version":3,"sources":["C:\\Users\\abdel\\PhpstormProjects\\update\\src\\navigation\\Navigation.js"],"names":["React","Component","TreeView","Constants","activites","selection","supprimerActivite","supprimerScenario","remplissageStockage","update","mise_a_jour_na","rechercheNav","compositions","download","liste_entite","ajouterActivite","ajouterTache","ajouterQuete","ajouterScenario","update_navigation","nav","setState","p","Navigation","constructor","props","recherche","id","state","nom","value","itemClicked","bind","e","i","nodes","length","color","GRAPH_NODES_DEFAULT_COLOR","search","itemData","tab","links","node","link","idPere","description","type","listeEntites","ACTIVITE","console","log","componentWillMount","supprimer","modifier","ajouter","res","nb","findIndex","x","monObjet","JSON","parse","localStorage","getItem","onChange","files","target","reader","FileReader","readAsBinaryString","result","previewFiles","preview","document","querySelector","readAndPreview","file","test","name","addEventListener","image","Image","height","title","src","appendChild","readAsDataURL","forEach","call","query","vFile","vReader","readAsText","onload","pEvent","vContent","vJson","push","activite","scenarios","quetes","taches","render","NAV_DEFAULT_HEIGHT","NAV_DEFAULT_WIDTH","NAV_DEFAULT_SEARCH_MODE","NAV_DEFAULT_SEARCH_ENABLE","onFormSubmit"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\n\r\nimport TreeView from \"devextreme-react/tree-view\";\r\n\r\nimport * as Constants from \"../configuration_app/Constants\";\r\n\r\nimport {activites, selection, supprimerActivite, supprimerScenario} from \"../data/data\";\r\nimport {remplissageStockage, update} from \"../App\";\r\nimport { mise_a_jour_na, rechercheNav} from \"../fonctions/helper/NavigationHelper\";\r\nimport {compositions} from \"../types/TypeComposition\";\r\nimport {download, liste_entite} from \"../fonctions/helper/AppHelper\";\r\nimport {ajouterActivite} from \"../fonctions/helper/ActiviteHelper\";\r\nimport {ajouterTache} from \"../fonctions/helper/TacheHelper\";\r\nimport {ajouterQuete} from \"../fonctions/helper/QueteHelper\";\r\nimport {ajouterScenario} from \"../fonctions/helper/ScenarioHelper\";\r\n\r\n\r\n\r\n//fonction qui met a jour la navigation\r\nexport function update_navigation (){\r\n    let nav = mise_a_jour_na();\r\n    this.setState({p:nav});\r\n}\r\n\r\n\r\n\r\nclass Navigation extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            nom:'test',\r\n            value: \"contains\",\r\n            p:[],\r\n        };\r\n\r\n        this.itemClicked = this.itemClicked.bind(this);\r\n        update_navigation = update_navigation.bind(this);\r\n\r\n    }\r\n\r\n\r\n\r\n    recherche=(id)=>{\r\n        // renvoie la liste des nodes et des links\r\n        return  rechercheNav(id);\r\n    };\r\n\r\n\r\n    itemClicked(e) {\r\n\r\n        for(let i=0;i<selection.nodes.length;i++) selection.nodes[i].color=Constants.GRAPH_NODES_DEFAULT_COLOR;\r\n\r\n        let search =this.recherche(e.itemData.id);\r\n        let tab = search.tab;\r\n        let i = search.i;\r\n\r\n        selection.nodes=tab[i].nodes;\r\n        selection.links=tab[i].links;\r\n        selection.node=null;\r\n        selection.link=null;\r\n        selection.nom=tab[i].nom;\r\n        selection.idPere=tab[i].idPere;\r\n        selection.id=tab[i].id;\r\n        selection.description=tab[i].description;\r\n        selection.type = tab[i].type;\r\n        selection.listeEntites = liste_entite(selection);\r\n\r\n        if (tab[i].type === compositions.ACTIVITE){\r\n            selection.idPere=null;\r\n            selection.listeEntites=tab[i].listeEntites;\r\n        }\r\n        update();\r\n        update_navigation();\r\n        console.log(download(selection.id));\r\n    }\r\n\r\n    componentWillMount() {\r\n        update_navigation();\r\n    }\r\n\r\n    supprimer(){\r\n        supprimerActivite(selection.id);\r\n        for(let i =0 ; i<selection.nodes.length;i++){\r\n            supprimerScenario(selection.nodes[i].id);\r\n        }\r\n        selection.id=null;\r\n        selection.nodes=[];\r\n        selection.listeEntites=[];\r\n        update_navigation();\r\n        update();\r\n\r\n    }\r\n\r\n    modifier(){\r\n        ///focntion qui modifie le nom d'une activite\r\n        selection.nom  = 'test';\r\n        let search = rechercheNav(selection.id);\r\n        let tab = search.tab;\r\n        let i = search.i;\r\n        tab[i].nom='test';\r\n        update_navigation();\r\n    }\r\n\r\n\r\n    ajouter(){\r\n        let res = 'Activite ';\r\n        let nb = activites.length+1;\r\n        let i = activites.findIndex(x=>x.nom===res+nb);\r\n        while (i!==-1){\r\n            nb=nb+1;\r\n            i = activites.findIndex(x=>x.nom===res+nb);\r\n        }\r\n        ajouterActivite(res+nb,'');\r\n        update_navigation();\r\n\r\n        remplissageStockage();\r\n\r\n        let monObjet = JSON.parse(localStorage.getItem(\"Activites\"));\r\n        console.log('json objett');\r\n        console.log(monObjet.length);\r\n    }\r\n\r\n\r\n    //on gére ouverture et fermeture du modal\r\n\r\n\r\n    onChange(e){\r\n        let files = e.target.files;\r\n        let reader=new FileReader();\r\n        console.log(files[0]);\r\n        reader.readAsBinaryString(files[0]);\r\n        //reader.onload\r\n\r\n        console.log(reader);\r\n        console.log(reader.result);\r\n\r\n    }\r\n\r\n     previewFiles() {\r\n\r\n        let preview = document.querySelector('#preview');\r\n        let files   = document.querySelector('input[type=file]').files;\r\n\r\n        function readAndPreview(file) {\r\n\r\n            // Veillez à ce que `file.name` corresponde à nos critères d’extension\r\n            if ( /\\.(json|JSON)$/i.test(file.name) ) {\r\n                let reader = new FileReader();\r\n\r\n                reader.addEventListener(\"load\", function () {\r\n                    let image = new Image();\r\n                    image.height = 100;\r\n                    image.title = file.name;\r\n                    image.src = this.result;\r\n                    preview.appendChild( image );\r\n                }, false);\r\n\r\n                reader.readAsDataURL(file);\r\n            }\r\n        }\r\n\r\n        if (files) {\r\n            [].forEach.call(files, readAndPreview);\r\n        }\r\n\r\n    }\r\n\r\n\r\n    query(e) {\r\n\r\n        //var vFile = document.getElementById(\"myfile\").files[0];\r\n        let vFile = e.target.files[0];\r\n        let vReader = new FileReader();\r\n        vReader.readAsText(vFile);\r\n        vReader.onload = function(pEvent) {\r\n            // String Input\r\n            let vContent = pEvent.target.result;\r\n            console.log(vContent)\r\n            // JSON to object\r\n            let vJson = JSON.parse(vContent);\r\n\r\n            activites.push(vJson.activite);\r\n           // scenarios.push(vJson.scenarios[0]);\r\n            //quetes.push(vJson.quetes[0]);\r\n            ajouterScenario(vJson.scenarios[0]);\r\n            ajouterQuete(vJson.quetes[0]);\r\n            ajouterTache(vJson.taches[0]);\r\n            //taches.push(vJson.taches);\r\n            console.log(vJson);\r\n            console.log(vJson.scenarios)\r\n            console.log(\"chargement terminer\")\r\n        };\r\n        update_navigation();\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <React.Fragment>\r\n                <TreeView\r\n                    id={ \"treeview\" }\r\n                    items={ this.state.p }\r\n                    height={ Constants.NAV_DEFAULT_HEIGHT }\r\n                    width={ Constants.NAV_DEFAULT_WIDTH }\r\n                    searchMode= { Constants.NAV_DEFAULT_SEARCH_MODE }\r\n                    searchEnabled={ Constants.NAV_DEFAULT_SEARCH_ENABLE }\r\n                    selectionMode={'single'}\r\n                    selectByClick={true}\r\n                    onItemClick={ this.itemClicked }\r\n                />\r\n                <button onClick={ this.supprimer}  hidden={selection.type!==compositions.ACTIVITE || activites.length===0}>del</button>\r\n                <button onClick={this.modifier} hidden={true}>mod</button>\r\n                <button  onClick={this.ajouter}>add</button>\r\n                <div onSubmit={this.onFormSubmit}>\r\n                    <input type='file' name='file' accept={\".json\"} onChange={(e)=>this.query(e)} multiple/>\r\n                </div>\r\n\r\n            </React.Fragment>\r\n        );\r\n    }\r\n}\r\n\r\nexport default Navigation;"]},"metadata":{},"sourceType":"module"}